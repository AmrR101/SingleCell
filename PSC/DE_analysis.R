library(dplyr)
library(Seurat)
library(patchwork)
library(ggplot2)
library(readr)
library(tidyr)
library(MAST)
library(readxl)
library(openxlsx)

data<- readRDS("Data/PSC_processed_oct.rds")
DefaultAssay(data) = "RNA"

# Inflamed vs Non-Inflamed
Idents(data) <- "inflammation"
Inflammation = FindAllMarkers(data, test.use = "MAST", only.pos = T)
Inflammation <- filter(Inflammation, Inflammation$p_val_adj < 0.05)

Idents(data) <- "celltypes"
Inflammation_IgG <- FindMarkers(data, subset.ident = "IgG_plasma", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_IgG <- filter(Inflammation_IgG, Inflammation_IgG$p_val_adj < 0.05)
Inflammation_IgG$cluster = ifelse(Inflammation_IgG$avg_logFC > 0,"I","NI")
Inflammation_IgG$gene = rownames(Inflammation_IgG)
Iup_IgG = filter(Inflammation_IgG, Inflammation_IgG$cluster == "I")
NIup_IgG = filter(Inflammation_IgG, Inflammation_IgG$cluster == "NI")
write.csv(Iup_IgG, "Results/DE/Iup_IgG.csv")
write.csv(NIup_IgG, "Results/DE/NIup_IgG.csv")

Inflammation_Treg <- FindMarkers(data, subset.ident = "Treg", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_Treg <- filter(Inflammation_Treg, Inflammation_Treg$p_val_adj < 0.05)
Inflammation_Treg$cluster = ifelse(Inflammation_Treg$avg_logFC > 0,"I","NI")
Inflammation_Treg$gene = rownames(Inflammation_Treg)
Iup_Treg = filter(Inflammation_Treg, Inflammation_Treg$cluster == "I")
NIup_Treg = filter(Inflammation_Treg, Inflammation_Treg$cluster == "NI")
write.csv(Iup_Treg, "Results/DE/Iup_Treg.csv")
write.csv(NIup_Treg, "Results/DE/NIup_Treg.csv")

Inflammation_Immature_entero <- FindMarkers(data, subset.ident = "Immature_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_Immature_entero <- filter(Inflammation_Immature_entero, Inflammation_Immature_entero$p_val_adj < 0.05)
Inflammation_Immature_entero$cluster = ifelse(Inflammation_Immature_entero$avg_logFC > 0,"I","NI")
Inflammation_Immature_entero$gene = rownames(Inflammation_Immature_entero)
Iup_Immature_entero = filter(Inflammation_Immature_entero, Inflammation_Immature_entero$cluster == "I")
NIup_Immature_entero = filter(Inflammation_Immature_entero, Inflammation_Immature_entero$cluster == "NI")
write.csv(Iup_Immature_entero, "Results/DE/Iup_Immature_entero.csv")
write.csv(NIup_Immature_entero, "Results/DE/NIup_Immature_entero.csv")

Inflammation_abs_TA <- FindMarkers(data, subset.ident = "Absorptive_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_abs_TA <- filter(Inflammation_abs_TA, Inflammation_abs_TA$p_val_adj < 0.05)
Inflammation_abs_TA$cluster = ifelse(Inflammation_abs_TA$avg_logFC > 0,"I","NI")
Inflammation_abs_TA$gene = rownames(Inflammation_abs_TA)
Iup_abs_TA = filter(Inflammation_abs_TA, Inflammation_abs_TA$cluster == "I")
NIup_abs_TA = filter(Inflammation_abs_TA, Inflammation_abs_TA$cluster == "NI")
write.csv(Iup_abs_TA, "Results/DE/Iup_abs_TA.csv")
write.csv(NIup_abs_TA, "Results/DE/NIup_abs_TA.csv")

Inflammation_abs_entero <- FindMarkers(data, subset.ident = "Absorptive_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_abs_entero <- filter(Inflammation_abs_entero, Inflammation_abs_entero$p_val_adj < 0.05)
Inflammation_abs_entero$cluster = ifelse(Inflammation_abs_entero$avg_logFC > 0,"I","NI")
Inflammation_abs_entero$gene = rownames(Inflammation_abs_entero)
Iup_abs_entero = filter(Inflammation_abs_entero, Inflammation_abs_entero$cluster == "I")
NIup_abs_entero = filter(Inflammation_abs_entero, Inflammation_abs_entero$cluster == "NI")
write.csv(Iup_abs_entero, "Results/DE/Iup_abs_entero.csv")
write.csv(NIup_abs_entero, "Results/DE/NIup_abs_entero.csv")

Inflammation_DUOX2_entero <- FindMarkers(data, subset.ident = "DUOX2_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_DUOX2_entero <- filter(Inflammation_DUOX2_entero, Inflammation_DUOX2_entero$p_val_adj < 0.05)
Inflammation_DUOX2_entero$cluster = ifelse(Inflammation_DUOX2_entero$avg_logFC > 0,"I","NI")
Inflammation_DUOX2_entero$gene = rownames(Inflammation_DUOX2_entero)
Iup_DUOX2_entero = filter(Inflammation_DUOX2_entero, Inflammation_DUOX2_entero$cluster == "I")
NIup_DUOX2_entero = filter(Inflammation_DUOX2_entero, Inflammation_DUOX2_entero$cluster == "NI")
write.csv(Iup_DUOX2_entero, "Results/DE/Iup_DUOX2_entero.csv")
write.csv(NIup_DUOX2_entero, "Results/DE/NIup_DUOX2_entero.csv")

Inflammation_Cycling_TA <- FindMarkers(data, subset.ident = "Cycling_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_Cycling_TA <- filter(Inflammation_Cycling_TA, Inflammation_Cycling_TA$p_val_adj < 0.05)
Inflammation_Cycling_TA$cluster = ifelse(Inflammation_Cycling_TA$avg_logFC > 0,"I","NI")
Inflammation_Cycling_TA$gene = rownames(Inflammation_Cycling_TA)
Iup_Cycling_TA = filter(Inflammation_Cycling_TA, Inflammation_Cycling_TA$cluster == "I")
NIup_Cycling_TA = filter(Inflammation_Cycling_TA, Inflammation_Cycling_TA$cluster == "NI")
write.csv(Iup_Cycling_TA, "Results/DE/Iup_Cycling_TA.csv")
write.csv(NIup_Cycling_TA, "Results/DE/NIup_Cycling_TA.csv")

Inflammation_Cycling_B <- FindMarkers(data, subset.ident = "Cycling_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_Cycling_B <- filter(Inflammation_Cycling_B, Inflammation_Cycling_B$p_val_adj < 0.05)
Inflammation_Cycling_B$cluster = ifelse(Inflammation_Cycling_B$avg_logFC > 0,"I","NI")
Inflammation_Cycling_B$gene = rownames(Inflammation_Cycling_B)
Iup_Cycling_B = filter(Inflammation_Cycling_B, Inflammation_Cycling_B$cluster == "I")
NIup_Cycling_B = filter(Inflammation_Cycling_B, Inflammation_Cycling_B$cluster == "NI")
write.csv(Iup_Cycling_B, "Results/DE/Iup_Cycling_B.csv")
write.csv(NIup_Cycling_B, "Results/DE/NIup_Cycling_B.csv")

Inflammation_GC <- FindMarkers(data, subset.ident = "GC", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_GC <- filter(Inflammation_GC, Inflammation_GC$p_val_adj < 0.05)
Inflammation_GC$cluster = ifelse(Inflammation_GC$avg_logFC > 0,"I","NI")
Inflammation_GC$gene = rownames(Inflammation_GC)
Iup_GC = filter(Inflammation_GC, Inflammation_GC$cluster == "I")
NIup_GC = filter(Inflammation_GC, Inflammation_GC$cluster == "NI")
write.csv(Iup_GC, "Results/DE/Iup_GC.csv")
write.csv(NIup_GC, "Results/DE/NIup_GC.csv")

Inflammation_BEST4_entero <- FindMarkers(data, subset.ident = "BEST4_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_BEST4_entero <- filter(Inflammation_BEST4_entero, Inflammation_BEST4_entero$p_val_adj < 0.05)
Inflammation_BEST4_entero$cluster = ifelse(Inflammation_BEST4_entero$avg_logFC > 0,"I","NI")
Inflammation_BEST4_entero$gene = rownames(Inflammation_BEST4_entero)
Iup_BEST4_entero = filter(Inflammation_BEST4_entero, Inflammation_BEST4_entero$cluster == "I")
NIup_BEST4_entero = filter(Inflammation_BEST4_entero, Inflammation_BEST4_entero$cluster == "NI")
write.csv(Iup_BEST4_entero, "Results/DE/Iup_BEST4_entero.csv")
write.csv(NIup_BEST4_entero, "Results/DE/NIup_BEST4_entero.csv")

Inflammation_Follicular <- FindMarkers(data, subset.ident = "Follicular_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_Follicular <- filter(Inflammation_Follicular, Inflammation_Follicular$p_val_adj < 0.05)
Inflammation_Follicular$cluster = ifelse(Inflammation_Follicular$avg_logFC > 0,"I","NI")
Inflammation_Follicular$gene = rownames(Inflammation_Follicular)
Iup_Follicular = filter(Inflammation_Follicular, Inflammation_Follicular$cluster == "I")
NIup_Follicular = filter(Inflammation_Follicular, Inflammation_Follicular$cluster == "NI")
write.csv(Iup_Follicular, "Results/DE/Iup_Follicular.csv")
write.csv(NIup_Follicular, "Results/DE/NIup_Follicular.csv")

Inflammation_activatedT_FOSlow <- FindMarkers(data, subset.ident = "T_activated_FOS_low", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_activatedT_FOSlow <- filter(Inflammation_activatedT_FOSlow, Inflammation_activatedT_FOSlow$p_val_adj < 0.05)
Inflammation_activatedT_FOSlow$cluster = ifelse(Inflammation_activatedT_FOSlow$avg_logFC > 0,"I","NI")
Inflammation_activatedT_FOSlow$gene = rownames(Inflammation_activatedT_FOSlow)
Iup_activatedT_FOSlow = filter(Inflammation_activatedT_FOSlow, Inflammation_activatedT_FOSlow$cluster == "I")
NIup_activatedT_FOSlow = filter(Inflammation_activatedT_FOSlow, Inflammation_activatedT_FOSlow$cluster == "NI")
write.csv(Iup_activatedT_FOSlow, "Results/DE/Iup_activatedT_FOSlow.csv")
write.csv(NIup_activatedT_FOSlow, "Results/DE/NIup_activatedT_FOSlow.csv")

Inflammation_activatedT_FOShigh <- FindMarkers(data, subset.ident = "T_activated_FOS_high", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_activatedT_FOShigh <- filter(Inflammation_activatedT_FOShigh, Inflammation_activatedT_FOShigh$p_val_adj < 0.05)
Inflammation_activatedT_FOShigh$cluster = ifelse(Inflammation_activatedT_FOShigh$avg_logFC > 0,"I","NI")
Inflammation_activatedT_FOShigh$gene = rownames(Inflammation_activatedT_FOShigh)
Iup_activatedT_FOShigh = filter(Inflammation_activatedT_FOShigh, Inflammation_activatedT_FOShigh$cluster == "I")
NIup_activatedT_FOShigh = filter(Inflammation_activatedT_FOShigh, Inflammation_activatedT_FOShigh$cluster == "NI")
write.csv(Iup_activatedT_FOShigh, "Results/DE/Iup_activatedT_FOShigh.csv")
write.csv(NIup_activatedT_FOShigh, "Results/DE/NIup_activatedT_FOShigh.csv")

Inflammation_Inflam_fibro <- FindMarkers(data, subset.ident = "Inflammatory_fibroblast", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_Inflam_fibro <- filter(Inflammation_Inflam_fibro, Inflammation_Inflam_fibro$p_val_adj < 0.05)
Inflammation_Inflam_fibro$cluster = ifelse(Inflammation_Inflam_fibro$avg_logFC > 0,"I","NI")
Inflammation_Inflam_fibro$gene = rownames(Inflammation_Inflam_fibro)
Iup_Inflam_fibro = filter(Inflammation_Inflam_fibro, Inflammation_Inflam_fibro$cluster == "I")
NIup_Inflam_fibro = filter(Inflammation_Inflam_fibro, Inflammation_Inflam_fibro$cluster == "NI")
write.csv(Iup_Inflam_fibro, "Results/DE/Iup_Inflam_fibro.csv")
write.csv(NIup_Inflam_fibro, "Results/DE/NIup_Inflam_fibro.csv")

Inflammation_RSPO3 <- FindMarkers(data, subset.ident = "RSPO3+", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_RSPO3 <- filter(Inflammation_RSPO3, Inflammation_RSPO3$p_val_adj < 0.05)
Inflammation_RSPO3$cluster = ifelse(Inflammation_RSPO3$avg_logFC > 0,"I","NI")
Inflammation_RSPO3$gene = rownames(Inflammation_RSPO3)
Iup_RSPO3 = filter(Inflammation_RSPO3, Inflammation_RSPO3$cluster == "I")
NIup_RSPO3 = filter(Inflammation_RSPO3, Inflammation_RSPO3$cluster == "NI")
write.csv(Iup_RSPO3, "Results/DE/Iup_RSPO3.csv")
write.csv(NIup_RSPO3, "Results/DE/NIup_RSPO3.csv")

Inflammation_stem <- FindMarkers(data, subset.ident = "Stem", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_stem <- filter(Inflammation_stem, Inflammation_stem$p_val_adj < 0.05)
Inflammation_stem$cluster = ifelse(Inflammation_stem$avg_logFC > 0,"I","NI")
Inflammation_stem$gene = rownames(Inflammation_stem)
Iup_stem = filter(Inflammation_stem, Inflammation_stem$cluster == "I")
NIup_stem = filter(Inflammation_stem, Inflammation_stem$cluster == "NI")
write.csv(Iup_stem, "Results/DE/Iup_stem.csv")
write.csv(NIup_stem, "Results/DE/NIup_stem.csv")

Inflammation_IgA <- FindMarkers(data, subset.ident = "IgA_plasma", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
Inflammation_IgA <- filter(Inflammation_IgA, Inflammation_IgA$p_val_adj < 0.05)
Inflammation_IgA$cluster = ifelse(Inflammation_IgA$avg_logFC > 0,"I","NI")
Inflammation_IgA$gene = rownames(Inflammation_IgA)
Iup_IgA = filter(Inflammation_IgA, Inflammation_IgA$cluster == "I")
NIup_IgA = filter(Inflammation_IgA, Inflammation_IgA$cluster == "NI")
write.csv(Iup_IgA, "Results/DE/Iup_IgA.csv")
write.csv(NIup_IgA, "Results/DE/NIup_IgA.csv")

# IBD vs HC
Idents(data) <- "disease"
Disease = FindAllMarkers(data, test.use = "MAST", only.pos = T)
Disease <- filter(Disease, Disease$p_val_adj < 0.05)

Idents(data) <- "celltypes"
Disease_IgG <- FindMarkers(data, subset.ident = "IgG_plasma", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_IgG <- filter(Disease_IgG, Disease_IgG$p_val_adj < 0.05)
Disease_IgG$cluster = ifelse(Disease_IgG$avg_logFC > 0,"IBD","HC")
Disease_IgG$gene = rownames(Disease_IgG)
IBDup_IgG = filter(Disease_IgG, Disease_IgG$cluster == "IBD")
HCup_IgG = filter(Disease_IgG, Disease_IgG$cluster == "HC")
write.csv(IBDup_IgG, "Results/DE/IBDup_IgG.csv")
write.csv(HCup_IgG, "Results/DE/HCup_IgG.csv")

Disease_Treg <- FindMarkers(data, subset.ident = "Treg", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_Treg <- filter(Disease_Treg, Disease_Treg$p_val_adj < 0.05)
Disease_Treg$cluster = ifelse(Disease_Treg$avg_logFC > 0,"IBD","HC")
Disease_Treg$gene = rownames(Disease_Treg)
IBDup_Treg = filter(Disease_Treg, Disease_Treg$cluster == "IBD")
HCup_Treg = filter(Disease_Treg, Disease_Treg$cluster == "HC")
write.csv(IBDup_Treg, "Results/DE/IBDup_Treg.csv")
write.csv(HCup_Treg, "Results/DE/HCup_Treg.csv")

Disease_abs_TA <- FindMarkers(data, subset.ident = "Absorptive_TA", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_abs_TA <- filter(Disease_abs_TA, Disease_abs_TA$p_val_adj < 0.05)
Disease_abs_TA$cluster = ifelse(Disease_abs_TA$avg_logFC > 0,"IBD","HC")
Disease_abs_TA$gene = rownames(Disease_abs_TA)
IBDup_abs_TA = filter(Disease_abs_TA, Disease_abs_TA$cluster == "IBD")
HCup_abs_TA = filter(Disease_abs_TA, Disease_abs_TA$cluster == "HC")
write.csv(IBDup_abs_TA, "Results/DE/IBDup_abs_TA.csv")
write.csv(HCup_abs_TA, "Results/DE/HCup_abs_TA.csv")

Disease_DUOX2_entero <- FindMarkers(data, subset.ident = "DUOX2_enterocyte", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_DUOX2_entero <- filter(Disease_DUOX2_entero, Disease_DUOX2_entero$p_val_adj < 0.05)
Disease_DUOX2_entero$cluster = ifelse(Disease_DUOX2_entero$avg_logFC > 0,"IBD","HC")
Disease_DUOX2_entero$gene = rownames(Disease_DUOX2_entero)
IBDup_DUOX2_entero = filter(Disease_DUOX2_entero, Disease_DUOX2_entero$cluster == "IBD")
HCup_DUOX2_entero = filter(Disease_DUOX2_entero, Disease_DUOX2_entero$cluster == "HC")
write.csv(IBDup_DUOX2_entero, "Results/DE/IBDup_DUOX2_entero.csv")
write.csv(HCup_DUOX2_entero, "Results/DE/HCup_DUOX2_entero.csv")

Disease_Cycling_TA <- FindMarkers(data, subset.ident = "Cycling_TA", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_Cycling_TA <- filter(Disease_Cycling_TA, Disease_Cycling_TA$p_val_adj < 0.05)
Disease_Cycling_TA$cluster = ifelse(Disease_Cycling_TA$avg_logFC > 0,"IBD","HC")
Disease_Cycling_TA$gene = rownames(Disease_Cycling_TA)
IBDup_Cycling_TA = filter(Disease_Cycling_TA, Disease_Cycling_TA$cluster == "IBD")
HCup_Cycling_TA = filter(Disease_Cycling_TA, Disease_Cycling_TA$cluster == "HC")
write.csv(IBDup_Cycling_TA, "Results/DE/IBDup_Cycling_TA.csv")
write.csv(HCup_Cycling_TA, "Results/DE/HCup_Cycling_TA.csv")

Disease_BEST4_entero <- FindMarkers(data, subset.ident = "BEST4_enterocyte", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_BEST4_entero <- filter(Disease_BEST4_entero, Disease_BEST4_entero$p_val_adj < 0.05)
Disease_BEST4_entero$cluster = ifelse(Disease_BEST4_entero$avg_logFC > 0,"IBD","HC")
Disease_BEST4_entero$gene = rownames(Disease_BEST4_entero)
IBDup_BEST4_entero = filter(Disease_BEST4_entero, Disease_BEST4_entero$cluster == "IBD")
HCup_BEST4_entero = filter(Disease_BEST4_entero, Disease_BEST4_entero$cluster == "HC")
write.csv(IBDup_BEST4_entero, "Results/DE/IBDup_BEST4_entero.csv")
write.csv(HCup_BEST4_entero, "Results/DE/HCup_BEST4_entero.csv")

Disease_PLCG2_TA <- FindMarkers(data, subset.ident = "PLCG2_TA", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_PLCG2_TA <- filter(Disease_PLCG2_TA, Disease_PLCG2_TA$p_val_adj < 0.05)
Disease_PLCG2_TA$cluster = ifelse(Disease_PLCG2_TA$avg_logFC > 0,"IBD","HC")
Disease_PLCG2_TA$gene = rownames(Disease_PLCG2_TA)
IBDup_PLCG2_TA = filter(Disease_PLCG2_TA, Disease_PLCG2_TA$cluster == "IBD")
HCup_PLCG2_TA = filter(Disease_PLCG2_TA, Disease_PLCG2_TA$cluster == "HC")
write.csv(IBDup_PLCG2_TA, "Results/DE/IBDup_PLCG2_TA.csv")
write.csv(HCup_PLCG2_TA, "Results/DE/HCup_PLCG2_TA.csv")

Disease_Ribo_TA <- FindMarkers(data, subset.ident = "Ribo_TA", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_Ribo_TA <- filter(Disease_Ribo_TA, Disease_Ribo_TA$p_val_adj < 0.05)
Disease_Ribo_TA$cluster = ifelse(Disease_Ribo_TA$avg_logFC > 0,"IBD","HC")
Disease_Ribo_TA$gene = rownames(Disease_Ribo_TA)
IBDup_Ribo_TA = filter(Disease_Ribo_TA, Disease_Ribo_TA$cluster == "IBD")
HCup_Ribo_TA = filter(Disease_Ribo_TA, Disease_Ribo_TA$cluster == "HC")
write.csv(IBDup_Ribo_TA, "Results/DE/IBDup_Ribo_TA.csv")
write.csv(HCup_Ribo_TA, "Results/DE/HCup_Ribo_TA.csv")

Disease_pericytes <- FindMarkers(data, subset.ident = "pericytes", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_pericytes <- filter(Disease_pericytes, Disease_pericytes$p_val_adj < 0.05)
Disease_pericytes$cluster = ifelse(Disease_pericytes$avg_logFC > 0,"IBD","HC")
Disease_pericytes$gene = rownames(Disease_pericytes)
IBDup_pericytes = filter(Disease_pericytes, Disease_pericytes$cluster == "IBD")
HCup_pericytes = filter(Disease_pericytes, Disease_pericytes$cluster == "HC")
write.csv(IBDup_pericytes, "Results/DE/IBDup_pericytes.csv")
write.csv(HCup_pericytes, "Results/DE/HCup_pericytes.csv")

Disease_PLCG2_TA <- FindMarkers(data, subset.ident = "PLCG2_TA", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_PLCG2_TA <- filter(Disease_PLCG2_TA, Disease_PLCG2_TA$p_val_adj < 0.05)
Disease_PLCG2_TA$cluster = ifelse(Disease_PLCG2_TA$avg_logFC > 0,"IBD","HC")
Disease_PLCG2_TA$gene = rownames(Disease_PLCG2_TA)
IBDup_PLCG2_TA = filter(Disease_PLCG2_TA, Disease_PLCG2_TA$cluster == "IBD")
HCup_PLCG2_TA = filter(Disease_PLCG2_TA, Disease_PLCG2_TA$cluster == "HC")
write.csv(IBDup_PLCG2_TA, "Results/DE/IBDup_PLCG2_TA.csv")
write.csv(HCup_PLCG2_TA, "Results/DE/HCup_PLCG2_TA.csv")

Disease_Ribo_TA <- FindMarkers(data, subset.ident = "Ribo_TA", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_Ribo_TA <- filter(Disease_Ribo_TA, Disease_Ribo_TA$p_val_adj < 0.05)
Disease_Ribo_TA$cluster = ifelse(Disease_Ribo_TA$avg_logFC > 0,"IBD","HC")
Disease_Ribo_TA$gene = rownames(Disease_Ribo_TA)
IBDup_Ribo_TA = filter(Disease_Ribo_TA, Disease_Ribo_TA$cluster == "IBD")
HCup_Ribo_TA = filter(Disease_Ribo_TA, Disease_Ribo_TA$cluster == "HC")
write.csv(IBDup_Ribo_TA, "Results/DE/IBDup_Ribo_TA.csv")
write.csv(HCup_Ribo_TA, "Results/DE/HCup_Ribo_TA.csv")

Disease_pericytes <- FindMarkers(data, subset.ident = "pericytes", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_pericytes <- filter(Disease_pericytes, Disease_pericytes$p_val_adj < 0.05)
Disease_pericytes$cluster = ifelse(Disease_pericytes$avg_logFC > 0,"IBD","HC")
Disease_pericytes$gene = rownames(Disease_pericytes)
IBDup_pericytes = filter(Disease_pericytes, Disease_pericytes$cluster == "IBD")
HCup_pericytes = filter(Disease_pericytes, Disease_pericytes$cluster == "HC")
write.csv(IBDup_pericytes, "Results/DE/IBDup_pericytes.csv")
write.csv(HCup_pericytes, "Results/DE/HCup_pericytes.csv")

Disease_IgA <- FindMarkers(data, subset.ident = "IgA_plasma", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_IgA <- filter(Disease_IgA, Disease_IgA$p_val_adj < 0.05)
Disease_IgA$cluster = ifelse(Disease_IgA$avg_logFC > 0,"IBD","HC")
Disease_IgA$gene = rownames(Disease_IgA)
IBDup_IgA = filter(Disease_IgA, Disease_IgA$cluster == "IBD")
HCup_IgA = filter(Disease_IgA, Disease_IgA$cluster == "HC")
write.csv(IBDup_IgA, "Results/DE/IBDup_IgA.csv")
write.csv(HCup_IgA, "Results/DE/HCup_IgA.csv")

Disease_activatedT_FOSlow <- FindMarkers(data, subset.ident = "T_activated_FOS_low", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_activatedT_FOSlow <- filter(Disease_activatedT_FOSlow, Disease_activatedT_FOSlow$p_val_adj < 0.05)
Disease_activatedT_FOSlow$cluster = ifelse(Disease_activatedT_FOSlow$avg_logFC > 0,"IBD","HC")
Disease_activatedT_FOSlow$gene = rownames(Disease_activatedT_FOSlow)
IBDup_activatedT_FOSlow = filter(Disease_activatedT_FOSlow, Disease_activatedT_FOSlow$cluster == "IBD")
HCup_activatedT_FOSlow = filter(Disease_activatedT_FOSlow, Disease_activatedT_FOSlow$cluster == "HC")
write.csv(IBDup_activatedT_FOSlow, "Results/DE/IBDup_activatedT_FOSlow.csv")
write.csv(HCup_activatedT_FOSlow, "Results/DE/HCup_activatedT_FOSlow.csv")

Disease_activatedT_FOShigh <- FindMarkers(data, subset.ident = "T_activated_FOS_high", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_activatedT_FOShigh <- filter(Disease_activatedT_FOShigh, Disease_activatedT_FOShigh$p_val_adj < 0.05)
Disease_activatedT_FOShigh$cluster = ifelse(Disease_activatedT_FOShigh$avg_logFC > 0,"IBD","HC")
Disease_activatedT_FOShigh$gene = rownames(Disease_activatedT_FOShigh)
IBDup_activatedT_FOShigh = filter(Disease_activatedT_FOShigh, Disease_activatedT_FOShigh$cluster == "IBD")
HCup_activatedT_FOShigh = filter(Disease_activatedT_FOShigh, Disease_activatedT_FOShigh$cluster == "HC")
write.csv(IBDup_activatedT_FOShigh, "Results/DE/IBDup_activatedT_FOShigh.csv")
write.csv(HCup_activatedT_FOShigh, "Results/DE/HCup_activatedT_FOShigh.csv")

Disease_Inflam_fibro <- FindMarkers(data, subset.ident = "Inflammatory_fibroblast", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_Inflam_fibro <- filter(Disease_Inflam_fibro, Disease_Inflam_fibro$p_val_adj < 0.05)
Disease_Inflam_fibro$cluster = ifelse(Disease_Inflam_fibro$avg_logFC > 0,"IBD","HC")
Disease_Inflam_fibro$gene = rownames(Disease_Inflam_fibro)
IBDup_Inflam_fibro = filter(Disease_Inflam_fibro, Disease_Inflam_fibro$cluster == "IBD")
HCup_Inflam_fibro = filter(Disease_Inflam_fibro, Disease_Inflam_fibro$cluster == "HC")
write.csv(IBDup_Inflam_fibro, "Results/DE/IBDup_Inflam_fibro.csv")
write.csv(HCup_Inflam_fibro, "Results/DE/HCup_Inflam_fibro.csv")

Disease_RSPO3 <- FindMarkers(data, subset.ident = "RSPO3+", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_RSPO3 <- filter(Disease_RSPO3, Disease_RSPO3$p_val_adj < 0.05)
Disease_RSPO3$cluster = ifelse(Disease_RSPO3$avg_logFC > 0,"IBD","HC")
Disease_RSPO3$gene = rownames(Disease_RSPO3)
IBDup_RSPO3 = filter(Disease_RSPO3, Disease_RSPO3$cluster == "IBD")
HCup_RSPO3 = filter(Disease_RSPO3, Disease_RSPO3$cluster == "HC")
write.csv(IBDup_RSPO3, "Results/DE/IBDup_RSPO3.csv")
write.csv(HCup_RSPO3, "Results/DE/HCup_RSPO3.csv")

Disease_stem <- FindMarkers(data, subset.ident = "Stem", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "PSC"), ident.2 = "HC")
Disease_stem <- filter(Disease_stem, Disease_stem$p_val_adj < 0.05)
Disease_stem$cluster = ifelse(Disease_stem$avg_logFC > 0,"IBD","HC")
Disease_stem$gene = rownames(Disease_stem)
IBDup_stem = filter(Disease_stem, Disease_stem$cluster == "IBD")
HCup_stem = filter(Disease_stem, Disease_stem$cluster == "HC")
write.csv(IBDup_stem, "Results/DE/IBDup_stem.csv")
write.csv(HCup_stem, "Results/DE/HCup_stem.csv")

# PSC vs non-PSC
Idents(data) <- "celltypes"
PSC_IgG <- FindMarkers(data, subset.ident = "IgG_plasma", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_IgG <- filter(PSC_IgG, PSC_IgG$p_val_adj < 0.05)
PSC_IgG$cluster = ifelse(PSC_IgG$avg_logFC > 0,"non-PSC","PSC")
PSC_IgG$gene = rownames(PSC_IgG)
nonPSCup_IgG = filter(PSC_IgG, PSC_IgG$cluster == "non-PSC")
PSCup_IgG = filter(PSC_IgG, PSC_IgG$cluster == "PSC")
write.csv(nonPSCup_IgG, "Results/DE/nonPSCup_IgG.csv")
write.csv(PSCup_IgG, "Results/DE/PSCup_IgG.csv")



PSC_Treg <- FindMarkers(data, subset.ident = "Treg", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_Treg <- filter(PSC_Treg, PSC_Treg$p_val_adj < 0.05)
PSC_Treg$cluster = ifelse(PSC_Treg$avg_logFC > 0,"non-PSC","PSC")
PSC_Treg$gene = rownames(PSC_Treg)
nonPSCup_Treg = filter(PSC_Treg, PSC_Treg$cluster == "non-PSC")
PSCup_Treg = filter(PSC_Treg, PSC_Treg$cluster == "PSC")
write.csv(nonPSCup_Treg, "Results/DE/nonPSCup_Treg.csv")
write.csv(PSCup_Treg, "Results/DE/PSCup_Treg.csv")

PSC_BEST4_entero <- FindMarkers(data, subset.ident = "BEST4_enterocyte", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_BEST4_entero <- filter(PSC_BEST4_entero, PSC_BEST4_entero$p_val_adj < 0.05)
PSC_BEST4_entero$cluster = ifelse(PSC_BEST4_entero$avg_logFC > 0,"non-PSC","PSC")
PSC_BEST4_entero$gene = rownames(PSC_BEST4_entero)
nonPSCup_BEST4_entero = filter(PSC_BEST4_entero, PSC_BEST4_entero$cluster == "non-PSC")
PSCup_BEST4_entero = filter(PSC_BEST4_entero, PSC_BEST4_entero$cluster == "PSC")
write.csv(nonPSCup_BEST4_entero, "Results/DE/nonPSCup_BEST4_entero.csv")
write.csv(PSCup_BEST4_entero, "Results/DE/PSCup_BEST4_entero.csv")

PSC_IgA <- FindMarkers(data, subset.ident = "IgA_plasma", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_IgA <- filter(PSC_IgA, PSC_IgA$p_val_adj < 0.05)
PSC_IgA$cluster = ifelse(PSC_IgA$avg_logFC > 0,"non-PSC","PSC")
PSC_IgA$gene = rownames(PSC_IgA)
nonPSCup_IgA = filter(PSC_IgA, PSC_IgA$cluster == "non-PSC")
PSCup_IgA = filter(PSC_IgA, PSC_IgA$cluster == "PSC")
write.csv(nonPSCup_IgA, "Results/DE/nonPSCup_IgA.csv")
write.csv(PSCup_IgA, "Results/DE/PSCup_IgA.csv")

PSC_activatedT_FOSlow <- FindMarkers(data, subset.ident = "T_activated_FOS_low", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_activatedT_FOSlow <- filter(PSC_activatedT_FOSlow, PSC_activatedT_FOSlow$p_val_adj < 0.05)
PSC_activatedT_FOSlow$cluster = ifelse(PSC_activatedT_FOSlow$avg_logFC > 0,"non-PSC","PSC")
PSC_activatedT_FOSlow$gene = rownames(PSC_activatedT_FOSlow)
nonPSCup_activatedT_FOSlow = filter(PSC_activatedT_FOSlow, PSC_activatedT_FOSlow$cluster == "non-PSC")
PSCup_activatedT_FOSlow = filter(PSC_activatedT_FOSlow, PSC_activatedT_FOSlow$cluster == "PSC")
write.csv(nonPSCup_activatedT_FOSlow, "Results/DE/nonPSCup_activatedT_FOSlow.csv")
write.csv(PSCup_activatedT_FOSlow, "Results/DE/PSCup_activatedT_FOSlow.csv")

PSC_activatedT_FOShigh <- FindMarkers(data, subset.ident = "T_activated_FOS_high", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_activatedT_FOShigh <- filter(PSC_activatedT_FOShigh, PSC_activatedT_FOShigh$p_val_adj < 0.05)
PSC_activatedT_FOShigh$cluster = ifelse(PSC_activatedT_FOShigh$avg_logFC > 0,"non-PSC","PSC")
PSC_activatedT_FOShigh$gene = rownames(PSC_activatedT_FOShigh)
nonPSCup_activatedT_FOShigh = filter(PSC_activatedT_FOShigh, PSC_activatedT_FOShigh$cluster == "non-PSC")
PSCup_activatedT_FOShigh = filter(PSC_activatedT_FOShigh, PSC_activatedT_FOShigh$cluster == "PSC")
write.csv(nonPSCup_activatedT_FOShigh, "Results/DE/nonPSCup_activatedT_FOShigh.csv")
write.csv(PSCup_activatedT_FOShigh, "Results/DE/PSCup_activatedT_FOShigh.csv")

PSC_Inflam_fibro <- FindMarkers(data, subset.ident = "Inflammatory_fibroblast", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_Inflam_fibro <- filter(PSC_Inflam_fibro, PSC_Inflam_fibro$p_val_adj < 0.05)
PSC_Inflam_fibro$cluster = ifelse(PSC_Inflam_fibro$avg_logFC > 0,"non-PSC","PSC")
PSC_Inflam_fibro$gene = rownames(PSC_Inflam_fibro)
nonPSCup_Inflam_fibro = filter(PSC_Inflam_fibro, PSC_Inflam_fibro$cluster == "non-PSC")
PSCup_Inflam_fibro = filter(PSC_Inflam_fibro, PSC_Inflam_fibro$cluster == "PSC")
write.csv(nonPSCup_Inflam_fibro, "Results/DE/nonPSCup_Inflam_fibro.csv")
write.csv(PSCup_Inflam_fibro, "Results/DE/PSCup_Inflam_fibro.csv")

PSC_RSPO3 <- FindMarkers(data, subset.ident = "RSPO3+", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_RSPO3 <- filter(PSC_RSPO3, PSC_RSPO3$p_val_adj < 0.05)
PSC_RSPO3$cluster = ifelse(PSC_RSPO3$avg_logFC > 0,"non-PSC","PSC")
PSC_RSPO3$gene = rownames(PSC_RSPO3)
nonPSCup_RSPO3 = filter(PSC_RSPO3, PSC_RSPO3$cluster == "non-PSC")
PSCup_RSPO3 = filter(PSC_RSPO3, PSC_RSPO3$cluster == "PSC")
write.csv(nonPSCup_RSPO3, "Results/DE/nonPSCup_RSPO3.csv")
write.csv(PSCup_RSPO3, "Results/DE/PSCup_RSPO3.csv")

PSC_stem <- FindMarkers(data, subset.ident = "Stem", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_stem <- filter(PSC_stem, PSC_stem$p_val_adj < 0.05)
PSC_stem$cluster = ifelse(PSC_stem$avg_logFC > 0,"non-PSC","PSC")
PSC_stem$gene = rownames(PSC_stem)
nonPSCup_stem = filter(PSC_stem, PSC_stem$cluster == "non-PSC")
PSCup_stem = filter(PSC_stem, PSC_stem$cluster == "PSC")
write.csv(nonPSCup_stem, "Results/DE/nonPSCup_stem.csv")
write.csv(PSCup_stem, "Results/DE/PSCup_stem.csv")

PSC_APC <- FindMarkers(data, subset.ident = "APC", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_APC <- filter(PSC_APC, PSC_APC$p_val_adj < 0.05)
PSC_APC$cluster = ifelse(PSC_APC$avg_logFC > 0,"non-PSC","PSC")
PSC_APC$gene = rownames(PSC_APC)
nonPSCup_APC = filter(PSC_APC, PSC_APC$cluster == "non-PSC")
PSCup_APC = filter(PSC_APC, PSC_APC$cluster == "PSC")
write.csv(nonPSCup_APC, "Results/DE/nonPSCup_APC.csv")
write.csv(PSCup_APC, "Results/DE/PSCup_APC.csv")

PSC_abs_entero <- FindMarkers(data, subset.ident = "abs_entero", group.by = "disease", test.use = "MAST", ident.1 = c("UC", "HC"), ident.2 = "PSC")
PSC_abs_entero <- filter(PSC_abs_entero, PSC_abs_entero$p_val_adj < 0.05)
PSC_abs_entero$cluster = ifelse(PSC_abs_entero$avg_logFC > 0,"non-PSC","PSC")
PSC_abs_entero$gene = rownames(PSC_abs_entero)
nonPSCup_abs_entero = filter(PSC_abs_entero, PSC_abs_entero$cluster == "non-PSC")
PSCup_abs_entero = filter(PSC_abs_entero, PSC_abs_entero$cluster == "PSC")
write.csv(nonPSCup_abs_entero, "Results/DE/nonPSCup_abs_entero.csv")
write.csv(PSCup_abs_entero, "Results/DE/PSCup_abs_entero.csv")

# Paired test PSC
Idents(data) = "sample"
data_PSC= subset(data, ident = c("3019","3069","3086","3147","3191","3317","3325"))

Idents(data_PSC) = "celltypes"
PSCINI_IgG <- FindMarkers(data_PSC, subset.ident = "IgG_plasma", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_IgG <- filter(PSCINI_IgG, PSCINI_IgG$p_val_adj < 0.05)
PSCINI_IgG$cluster = ifelse(PSCINI_IgG$avg_logFC > 0,"I","NI")
PSCINI_IgG$gene = rownames(PSCINI_IgG)
PSCIup_IgG = filter(PSCINI_IgG, PSCINI_IgG$cluster == "I")
PSCNIup_IgG = filter(PSCINI_IgG, PSCINI_IgG$cluster == "NI")
write.csv(PSCIup_IgG, "Results/DE/PSCIup_IgG.csv")
write.csv(PSCNIup_IgG, "Results/DE/PSCNIup_IgG.csv")
GO_PSCIup_IgG=enrichr(PSCIup_IgG$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_IgG <- filter(GO_PSCIup_IgG, GO_PSCIup_IgG$Adjusted.P.value< 0.05)
GO_PSCNIup_IgG=enrichr(PSCNIup_IgG$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_IgG <- filter(GO_PSCNIup_IgG, GO_PSCNIup_IgG$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_IgG, "Results/DE/GO_PSCNIup_IgG.csv")
write.csv(GO_PSCIup_IgG, "Results/DE/GO_PSCIup_IgG.csv")

PSCINI_Treg <- FindMarkers(data_PSC, subset.ident = "Treg", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Treg <- filter(PSCINI_Treg, PSCINI_Treg$p_val_adj < 0.05)
PSCINI_Treg$cluster = ifelse(PSCINI_Treg$avg_logFC > 0,"I","NI")
PSCINI_Treg$gene = rownames(PSCINI_Treg)
PSCIup_Treg = filter(PSCINI_Treg, PSCINI_Treg$cluster == "I")
PSCNIup_Treg = filter(PSCINI_Treg, PSCINI_Treg$cluster == "NI")
write.csv(PSCIup_Treg, "Results/DE/PSCIup_Treg.csv")
write.csv(PSCNIup_Treg, "Results/DE/PSCNIup_Treg.csv")
GO_PSCIup_Treg=enrichr(PSCIup_Treg$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Treg <- filter(GO_PSCIup_Treg, GO_PSCIup_Treg$Adjusted.P.value< 0.05)
GO_PSCNIup_Treg=enrichr(PSCNIup_Treg$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Treg <- filter(GO_PSCNIup_Treg, GO_PSCNIup_Treg$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Treg, "Results/DE/GO_PSCNIup_Treg.csv")
write.csv(GO_PSCIup_Treg, "Results/DE/GO_PSCIup_Treg.csv")

PSCINI_ActivatedT_FOSlow <- FindMarkers(data_PSC, subset.ident = "T_activated_FOS_low", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_ActivatedT_FOSlow <- filter(PSCINI_ActivatedT_FOSlow, PSCINI_ActivatedT_FOSlow$p_val_adj < 0.05)
PSCINI_ActivatedT_FOSlow$cluster = ifelse(PSCINI_ActivatedT_FOSlow$avg_logFC > 0,"I","NI")
PSCINI_ActivatedT_FOSlow$gene = rownames(PSCINI_ActivatedT_FOSlow)
PSCIup_ActivatedT_FOSlow = filter(PSCINI_ActivatedT_FOSlow, PSCINI_ActivatedT_FOSlow$cluster == "I")
PSCNIup_ActivatedT_FOSlow = filter(PSCINI_ActivatedT_FOSlow, PSCINI_ActivatedT_FOSlow$cluster == "NI")
write.csv(PSCIup_ActivatedT_FOSlow, "Results/DE/PSCIup_ActivatedT_FOSlow.csv")
write.csv(PSCNIup_ActivatedT_FOSlow, "Results/DE/PSCNIup_ActivatedT_FOSlow.csv")
GO_PSCIup_ActivatedT_FOSlow=enrichr(PSCIup_ActivatedT_FOSlow$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_ActivatedT_FOSlow <- filter(GO_PSCIup_ActivatedT_FOSlow, GO_PSCIup_ActivatedT_FOSlow$Adjusted.P.value< 0.05)
GO_PSCNIup_ActivatedT_FOSlow=enrichr(PSCNIup_ActivatedT_FOSlow$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_ActivatedT_FOSlow <- filter(GO_PSCNIup_ActivatedT_FOSlow, GO_PSCNIup_ActivatedT_FOSlow$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_ActivatedT_FOSlow, "Results/DE/GO_PSCNIup_ActivatedT_FOSlow.csv")
write.csv(GO_PSCIup_ActivatedT_FOSlow, "Results/DE/GO_PSCIup_ActivatedT_FOSlow.csv")

PSCINI_APC <- FindMarkers(data_PSC, subset.ident = "APC", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_APC <- filter(PSCINI_APC, PSCINI_APC$p_val_adj < 0.05)
PSCINI_APC$cluster = ifelse(PSCINI_APC$avg_logFC > 0,"I","NI")
PSCINI_APC$gene = rownames(PSCINI_APC)
PSCIup_APC = filter(PSCINI_APC, PSCINI_APC$cluster == "I")
PSCNIup_APC = filter(PSCINI_APC, PSCINI_APC$cluster == "NI")
write.csv(PSCIup_APC, "Results/DE/PSCIup_APC.csv")
write.csv(PSCNIup_APC, "Results/DE/PSCNIup_APC.csv")
GO_PSCIup_APC=enrichr(PSCIup_APC$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_APC <- filter(GO_PSCIup_APC, GO_PSCIup_APC$Adjusted.P.value< 0.05)
GO_PSCNIup_APC=enrichr(PSCNIup_APC$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_APC <- filter(GO_PSCNIup_APC, GO_PSCNIup_APC$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_APC, "Results/DE/GO_PSCNIup_APC.csv")
write.csv(GO_PSCIup_APC, "Results/DE/GO_PSCIup_APC.csv")

PSCINI_Follicular <- FindMarkers(data_PSC, subset.ident = "Follicular_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Follicular <- filter(PSCINI_Follicular, PSCINI_Follicular$p_val_adj < 0.05)
PSCINI_Follicular$cluster = ifelse(PSCINI_Follicular$avg_logFC > 0,"I","NI")
PSCINI_Follicular$gene = rownames(PSCINI_Follicular)
PSCIup_Follicular = filter(PSCINI_Follicular, PSCINI_Follicular$cluster == "I")
PSCNIup_Follicular = filter(PSCINI_Follicular, PSCINI_Follicular$cluster == "NI")
write.csv(PSCIup_Follicular, "Results/DE/PSCIup_Follicular.csv")
write.csv(PSCNIup_Follicular, "Results/DE/PSCNIup_Follicular.csv")
GO_PSCIup_Follicular=enrichr(PSCIup_Follicular$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Follicular <- filter(GO_PSCIup_Follicular, GO_PSCIup_Follicular$Adjusted.P.value< 0.05)
GO_PSCNIup_Follicular=enrichr(PSCNIup_Follicular$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Follicular <- filter(GO_PSCNIup_Follicular, GO_PSCNIup_Follicular$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Follicular, "Results/DE/GO_PSCNIup_Follicular.csv")
write.csv(GO_PSCIup_Follicular, "Results/DE/GO_PSCIup_Follicular.csv")

PSCINI_IgA <- FindMarkers(data_PSC, subset.ident = "IgA_plasma", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_IgA <- filter(PSCINI_IgA, PSCINI_IgA$p_val_adj < 0.05)
PSCINI_IgA$cluster = ifelse(PSCINI_IgA$avg_logFC > 0,"I","NI")
PSCINI_IgA$gene = rownames(PSCINI_IgA)
PSCIup_IgA = filter(PSCINI_IgA, PSCINI_IgA$cluster == "I")
PSCNIup_IgA = filter(PSCINI_IgA, PSCINI_IgA$cluster == "NI")
write.csv(PSCIup_IgA, "Results/DE/PSCIup_IgA.csv")
write.csv(PSCNIup_IgA, "Results/DE/PSCNIup_IgA.csv")
GO_PSCIup_IgA=enrichr(PSCIup_IgA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_IgA <- filter(GO_PSCIup_IgA, GO_PSCIup_IgA$Adjusted.P.value< 0.05)
GO_PSCNIup_IgA=enrichr(PSCNIup_IgA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_IgA <- filter(GO_PSCNIup_IgA, GO_PSCNIup_IgA$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_IgA, "Results/DE/GO_PSCNIup_IgA.csv")
write.csv(GO_PSCIup_IgA, "Results/DE/GO_PSCIup_IgA.csv")

PSCINI_Inflam_fibro <- FindMarkers(data_PSC, subset.ident = "Inflammatory_fibroblast", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Inflam_fibro <- filter(PSCINI_Inflam_fibro, PSCINI_Inflam_fibro$p_val_adj < 0.05)
PSCINI_Inflam_fibro$cluster = ifelse(PSCINI_Inflam_fibro$avg_logFC > 0,"I","NI")
PSCINI_Inflam_fibro$gene = rownames(PSCINI_Inflam_fibro)
PSCIup_Inflam_fibro = filter(PSCINI_Inflam_fibro, PSCINI_Inflam_fibro$cluster == "I")
PSCNIup_Inflam_fibro = filter(PSCINI_Inflam_fibro, PSCINI_Inflam_fibro$cluster == "NI")
write.csv(PSCIup_Inflam_fibro, "Results/DE/PSCIup_Inflam_fibro.csv")
write.csv(PSCNIup_Inflam_fibro, "Results/DE/PSCNIup_Inflam_fibro.csv")
GO_PSCIup_Inflam_fibro=enrichr(PSCIup_Inflam_fibro$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Inflam_fibro <- filter(GO_PSCIup_Inflam_fibro, GO_PSCIup_Inflam_fibro$Adjusted.P.value< 0.05)
GO_PSCNIup_Inflam_fibro=enrichr(PSCNIup_Inflam_fibro$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Inflam_fibro <- filter(GO_PSCNIup_Inflam_fibro, GO_PSCNIup_Inflam_fibro$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Inflam_fibro, "Results/DE/GO_PSCNIup_Inflam_fibro.csv")
write.csv(GO_PSCIup_Inflam_fibro, "Results/DE/GO_PSCIup_Inflam_fibro.csv")

PSCINI_abs_entero <- FindMarkers(data_PSC, subset.ident = "Absorptive_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_abs_entero <- filter(PSCINI_abs_entero, PSCINI_abs_entero$p_val_adj < 0.05)
PSCINI_abs_entero$cluster = ifelse(PSCINI_abs_entero$avg_logFC > 0,"I","NI")
PSCINI_abs_entero$gene = rownames(PSCINI_abs_entero)
PSCIup_abs_entero = filter(PSCINI_abs_entero, PSCINI_abs_entero$cluster == "I")
PSCNIup_abs_entero = filter(PSCINI_abs_entero, PSCINI_abs_entero$cluster == "NI")
write.csv(PSCIup_abs_entero, "Results/DE/PSCIup_abs_entero.csv")
write.csv(PSCNIup_abs_entero, "Results/DE/PSCNIup_abs_entero.csv")
GO_PSCIup_abs_entero=enrichr(PSCIup_abs_entero$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_abs_entero <- filter(GO_PSCIup_abs_entero, GO_PSCIup_abs_entero$Adjusted.P.value< 0.05)
GO_PSCNIup_abs_entero=enrichr(PSCNIup_abs_entero$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_abs_entero <- filter(GO_PSCNIup_abs_entero, GO_PSCNIup_abs_entero$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_abs_entero, "Results/DE/GO_PSCNIup_abs_entero.csv")
write.csv(GO_PSCIup_abs_entero, "Results/DE/GO_PSCIup_abs_entero.csv")

PSCINI_stem <- FindMarkers(data_PSC, subset.ident = "Stem", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_stem <- filter(PSCINI_stem, PSCINI_stem$p_val_adj < 0.05)
PSCINI_stem$cluster = ifelse(PSCINI_stem$avg_logFC > 0,"I","NI")
PSCINI_stem$gene = rownames(PSCINI_stem)
PSCIup_stem = filter(PSCINI_stem, PSCINI_stem$cluster == "I")
PSCNIup_stem = filter(PSCINI_stem, PSCINI_stem$cluster == "NI")
write.csv(PSCIup_stem, "Results/DE/PSCIup_stem.csv")
write.csv(PSCNIup_stem, "Results/DE/PSCNIup_stem.csv")
GO_PSCIup_stem=enrichr(PSCIup_stem$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_stem <- filter(GO_PSCIup_stem, GO_PSCIup_stem$Adjusted.P.value< 0.05)
GO_PSCNIup_stem=enrichr(PSCNIup_stem$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_stem <- filter(GO_PSCNIup_stem, GO_PSCNIup_stem$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_stem, "Results/DE/GO_PSCNIup_stem.csv")
write.csv(GO_PSCIup_stem, "Results/DE/GO_PSCIup_stem.csv")

PSCINI_Enteroendocrine <- FindMarkers(data_PSC, subset.ident = "Enteroendocrine", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Enteroendocrine <- filter(PSCINI_Enteroendocrine, PSCINI_Enteroendocrine$p_val_adj < 0.05)
PSCINI_Enteroendocrine$cluster = ifelse(PSCINI_Enteroendocrine$avg_logFC > 0,"I","NI")
PSCINI_Enteroendocrine$gene = rownames(PSCINI_Enteroendocrine)
PSCIup_Enteroendocrine = filter(PSCINI_Enteroendocrine, PSCINI_Enteroendocrine$cluster == "I")
PSCNIup_Enteroendocrine = filter(PSCINI_Enteroendocrine, PSCINI_Enteroendocrine$cluster == "NI")
write.csv(PSCIup_Enteroendocrine, "Results/DE/PSCIup_Enteroendocrine.csv")
write.csv(PSCNIup_Enteroendocrine, "Results/DE/PSCNIup_Enteroendocrine.csv")
GO_PSCIup_Enteroendocrine=enrichr(PSCIup_Enteroendocrine$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Enteroendocrine <- filter(GO_PSCIup_Enteroendocrine, GO_PSCIup_Enteroendocrine$Adjusted.P.value< 0.05)
GO_PSCNIup_Enteroendocrine=enrichr(PSCNIup_Enteroendocrine$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Enteroendocrine <- filter(GO_PSCNIup_Enteroendocrine, GO_PSCNIup_Enteroendocrine$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Enteroendocrine, "Results/DE/GO_PSCNIup_Enteroendocrine.csv")
write.csv(GO_PSCIup_Enteroendocrine, "Results/DE/GO_PSCIup_Enteroendocrine.csv")

PSCINI_Goblet <- FindMarkers(data_PSC, subset.ident = "Goblet", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Goblet <- filter(PSCINI_Goblet, PSCINI_Goblet$p_val_adj < 0.05)
PSCINI_Goblet$cluster = ifelse(PSCINI_Goblet$avg_logFC > 0,"I","NI")
PSCINI_Goblet$gene = rownames(PSCINI_Goblet)
PSCIup_Goblet = filter(PSCINI_Goblet, PSCINI_Goblet$cluster == "I")
PSCNIup_Goblet = filter(PSCINI_Goblet, PSCINI_Goblet$cluster == "NI")
write.csv(PSCIup_Goblet, "Results/DE/PSCIup_Goblet.csv")
write.csv(PSCNIup_Goblet, "Results/DE/PSCNIup_Goblet.csv")
GO_PSCIup_Goblet=enrichr(PSCIup_Goblet$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Goblet <- filter(GO_PSCIup_Goblet, GO_PSCIup_Goblet$Adjusted.P.value< 0.05)
GO_PSCNIup_Goblet=enrichr(PSCNIup_Goblet$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Goblet <- filter(GO_PSCNIup_Goblet, GO_PSCNIup_Goblet$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Goblet, "Results/DE/GO_PSCNIup_Goblet.csv")
write.csv(GO_PSCIup_Goblet, "Results/DE/GO_PSCIup_Goblet.csv")

PSCINI_MAST <- FindMarkers(data_PSC, subset.ident = "MAST", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_MAST <- filter(PSCINI_MAST, PSCINI_MAST$p_val_adj < 0.05)
PSCINI_MAST$cluster = ifelse(PSCINI_MAST$avg_logFC > 0,"I","NI")
PSCINI_MAST$gene = rownames(PSCINI_MAST)
PSCIup_MAST = filter(PSCINI_MAST, PSCINI_MAST$cluster == "I")
PSCNIup_MAST = filter(PSCINI_MAST, PSCINI_MAST$cluster == "NI")
write.csv(PSCIup_MAST, "Results/DE/PSCIup_MAST.csv")
write.csv(PSCNIup_MAST, "Results/DE/PSCNIup_MAST.csv")
GO_PSCIup_MAST=enrichr(PSCIup_MAST$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_MAST <- filter(GO_PSCIup_MAST, GO_PSCIup_MAST$Adjusted.P.value< 0.05)
GO_PSCNIup_MAST=enrichr(PSCNIup_MAST$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_MAST <- filter(GO_PSCNIup_MAST, GO_PSCNIup_MAST$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_MAST, "Results/DE/GO_PSCNIup_MAST.csv")
write.csv(GO_PSCIup_MAST, "Results/DE/GO_PSCIup_MAST.csv")

PSCINI_RSPO3 <- FindMarkers(data_PSC, subset.ident = "RSPO3+", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_RSPO3 <- filter(PSCINI_RSPO3, PSCINI_RSPO3$p_val_adj < 0.05)
PSCINI_RSPO3$cluster = ifelse(PSCINI_RSPO3$avg_logFC > 0,"I","NI")
PSCINI_RSPO3$gene = rownames(PSCINI_RSPO3)
PSCIup_RSPO3 = filter(PSCINI_RSPO3, PSCINI_RSPO3$cluster == "I")
PSCNIup_RSPO3 = filter(PSCINI_RSPO3, PSCINI_RSPO3$cluster == "NI")
write.csv(PSCIup_RSPO3, "Results/DE/PSCIup_RSPO3.csv")
write.csv(PSCNIup_RSPO3, "Results/DE/PSCNIup_RSPO3.csv")
GO_PSCIup_RSPO3=enrichr(PSCIup_RSPO3$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_RSPO3 <- filter(GO_PSCIup_RSPO3, GO_PSCIup_RSPO3$Adjusted.P.value< 0.05)
GO_PSCNIup_RSPO3=enrichr(PSCNIup_RSPO3$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_RSPO3 <- filter(GO_PSCNIup_RSPO3, GO_PSCNIup_RSPO3$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_RSPO3, "Results/DE/GO_PSCNIup_RSPO3.csv")
write.csv(GO_PSCIup_RSPO3, "Results/DE/GO_PSCIup_RSPO3.csv")

PSCINI_WNT2B <- FindMarkers(data_PSC, subset.ident = "WNT2B+", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_WNT2B <- filter(PSCINI_WNT2B, PSCINI_WNT2B$p_val_adj < 0.05)
PSCINI_WNT2B$cluster = ifelse(PSCINI_WNT2B$avg_logFC > 0,"I","NI")
PSCINI_WNT2B$gene = rownames(PSCINI_WNT2B)
PSCIup_WNT2B = filter(PSCINI_WNT2B, PSCINI_WNT2B$cluster == "I")
PSCNIup_WNT2B = filter(PSCINI_WNT2B, PSCINI_WNT2B$cluster == "NI")
write.csv(PSCIup_WNT2B, "Results/DE/PSCIup_WNT2B.csv")
write.csv(PSCNIup_WNT2B, "Results/DE/PSCNIup_WNT2B.csv")
GO_PSCIup_WNT2B=enrichr(PSCIup_WNT2B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_WNT2B <- filter(GO_PSCIup_WNT2B, GO_PSCIup_WNT2B$Adjusted.P.value< 0.05)
GO_PSCNIup_WNT2B=enrichr(PSCNIup_WNT2B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_WNT2B <- filter(GO_PSCNIup_WNT2B, GO_PSCNIup_WNT2B$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_WNT2B, "Results/DE/GO_PSCNIup_WNT2B.csv")
write.csv(GO_PSCIup_WNT2B, "Results/DE/GO_PSCIup_WNT2B.csv")

PSCINI_WNT5B <- FindMarkers(data_PSC, subset.ident = "WNT5B+", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_WNT5B <- filter(PSCINI_WNT5B, PSCINI_WNT5B$p_val_adj < 0.05)
PSCINI_WNT5B$cluster = ifelse(PSCINI_WNT5B$avg_logFC > 0,"I","NI")
PSCINI_WNT5B$gene = rownames(PSCINI_WNT5B)
PSCIup_WNT5B = filter(PSCINI_WNT5B, PSCINI_WNT5B$cluster == "I")
PSCNIup_WNT5B = filter(PSCINI_WNT5B, PSCINI_WNT5B$cluster == "NI")
write.csv(PSCIup_WNT5B, "Results/DE/PSCIup_WNT5B.csv")
write.csv(PSCNIup_WNT5B, "Results/DE/PSCNIup_WNT5B.csv")
GO_PSCIup_WNT5B=enrichr(PSCIup_WNT5B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_WNT5B <- filter(GO_PSCIup_WNT5B, GO_PSCIup_WNT5B$Adjusted.P.value< 0.05)
GO_PSCNIup_WNT5B=enrichr(PSCNIup_WNT5B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_WNT5B <- filter(GO_PSCNIup_WNT5B, GO_PSCNIup_WNT5B$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_WNT5B, "Results/DE/GO_PSCNIup_WNT5B.csv")
write.csv(GO_PSCIup_WNT5B, "Results/DE/GO_PSCIup_WNT5B.csv")

PSCINI_endothelial <- FindMarkers(data_PSC, subset.ident = "endothelial", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_endothelial <- filter(PSCINI_endothelial, PSCINI_endothelial$p_val_adj < 0.05)
PSCINI_endothelial$cluster = ifelse(PSCINI_endothelial$avg_logFC > 0,"I","NI")
PSCINI_endothelial$gene = rownames(PSCINI_endothelial)
PSCIup_endothelial = filter(PSCINI_endothelial, PSCINI_endothelial$cluster == "I")
PSCNIup_endothelial = filter(PSCINI_endothelial, PSCINI_endothelial$cluster == "NI")
write.csv(PSCIup_endothelial, "Results/DE/PSCIup_endothelial.csv")
write.csv(PSCNIup_endothelial, "Results/DE/PSCNIup_endothelial.csv")
GO_PSCIup_endothelial=enrichr(PSCIup_endothelial$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_endothelial <- filter(GO_PSCIup_endothelial, GO_PSCIup_endothelial$Adjusted.P.value< 0.05)
GO_PSCNIup_endothelial=enrichr(PSCNIup_endothelial$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_endothelial <- filter(GO_PSCNIup_endothelial, GO_PSCNIup_endothelial$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_endothelial, "Results/DE/GO_PSCNIup_endothelial.csv")
write.csv(GO_PSCIup_endothelial, "Results/DE/GO_PSCIup_endothelial.csv")

PSCINI_pericyte <- FindMarkers(data_PSC, subset.ident = "pericytes", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_pericyte <- filter(PSCINI_pericyte, PSCINI_pericyte$p_val_adj < 0.05)
PSCINI_pericyte$cluster = ifelse(PSCINI_pericyte$avg_logFC > 0,"I","NI")
PSCINI_pericyte$gene = rownames(PSCINI_pericyte)
PSCIup_pericyte = filter(PSCINI_pericyte, PSCINI_pericyte$cluster == "I")
PSCNIup_pericyte = filter(PSCINI_pericyte, PSCINI_pericyte$cluster == "NI")
write.csv(PSCIup_pericyte, "Results/DE/PSCIup_pericyte.csv")
write.csv(PSCNIup_pericyte, "Results/DE/PSCNIup_pericyte.csv")
GO_PSCIup_pericyte=enrichr(PSCIup_pericyte$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_pericyte <- filter(GO_PSCIup_pericyte, GO_PSCIup_pericyte$Adjusted.P.value< 0.05)
GO_PSCNIup_pericyte=enrichr(PSCNIup_pericyte$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_pericyte <- filter(GO_PSCNIup_pericyte, GO_PSCNIup_pericyte$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_pericyte, "Results/DE/GO_PSCNIup_pericyte.csv")
write.csv(GO_PSCIup_pericyte, "Results/DE/GO_PSCIup_pericyte.csv")

PSCINI_glia <- FindMarkers(data_PSC, subset.ident = "glia", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_glia <- filter(PSCINI_glia, PSCINI_glia$p_val_adj < 0.05)
PSCINI_glia$cluster = ifelse(PSCINI_glia$avg_logFC > 0,"I","NI")
PSCINI_glia$gene = rownames(PSCINI_glia)
PSCIup_glia = filter(PSCINI_glia, PSCINI_glia$cluster == "I")
PSCNIup_glia = filter(PSCINI_glia, PSCINI_glia$cluster == "NI")
write.csv(PSCIup_glia, "Results/DE/PSCIup_glia.csv")
write.csv(PSCNIup_glia, "Results/DE/PSCNIup_glia.csv")
GO_PSCIup_glia=enrichr(PSCIup_glia$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_glia <- filter(GO_PSCIup_glia, GO_PSCIup_glia$Adjusted.P.value< 0.05)
GO_PSCNIup_glia=enrichr(PSCNIup_glia$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_glia <- filter(GO_PSCNIup_glia, GO_PSCNIup_glia$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_glia, "Results/DE/GO_PSCNIup_glia.csv")
write.csv(GO_PSCIup_glia, "Results/DE/GO_PSCIup_glia.csv")

PSCINI_myofibro <- FindMarkers(data_PSC, subset.ident = "myofibroblasts", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_myofibro <- filter(PSCINI_myofibro, PSCINI_myofibro$p_val_adj < 0.05)
PSCINI_myofibro$cluster = ifelse(PSCINI_myofibro$avg_logFC > 0,"I","NI")
PSCINI_myofibro$gene = rownames(PSCINI_myofibro)
PSCIup_myofibro = filter(PSCINI_myofibro, PSCINI_myofibro$cluster == "I")
PSCNIup_myofibro = filter(PSCINI_myofibro, PSCINI_myofibro$cluster == "NI")
write.csv(PSCIup_myofibro, "Results/DE/PSCIup_myofibro.csv")
write.csv(PSCNIup_myofibro, "Results/DE/PSCNIup_myofibro.csv")
GO_PSCIup_myofibro=enrichr(PSCIup_myofibro$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_myofibro <- filter(GO_PSCIup_myofibro, GO_PSCIup_myofibro$Adjusted.P.value< 0.05)
GO_PSCNIup_myofibro=enrichr(PSCNIup_myofibro$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_myofibro <- filter(GO_PSCNIup_myofibro, GO_PSCNIup_myofibro$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_myofibro, "Results/DE/GO_PSCNIup_myofibro.csv")
write.csv(GO_PSCIup_myofibro, "Results/DE/GO_PSCIup_myofibro.csv")

PSCINI_memoryT <- FindMarkers(data_PSC, subset.ident = "CD4_T_memory", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_memoryT <- filter(PSCINI_memoryT, PSCINI_memoryT$p_val_adj < 0.05)
PSCINI_memoryT$cluster = ifelse(PSCINI_memoryT$avg_logFC > 0,"I","NI")
PSCINI_memoryT$gene = rownames(PSCINI_memoryT)
PSCIup_memoryT = filter(PSCINI_memoryT, PSCINI_memoryT$cluster == "I")
PSCNIup_memoryT = filter(PSCINI_memoryT, PSCINI_memoryT$cluster == "NI")
write.csv(PSCIup_memoryT, "Results/DE/PSCIup_memoryT.csv")
write.csv(PSCNIup_memoryT, "Results/DE/PSCNIup_memoryT.csv")
GO_PSCIup_memoryT=enrichr(PSCIup_memoryT$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_memoryT <- filter(GO_PSCIup_memoryT, GO_PSCIup_memoryT$Adjusted.P.value< 0.05)
GO_PSCNIup_memoryT=enrichr(PSCNIup_memoryT$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_memoryT <- filter(GO_PSCNIup_memoryT, GO_PSCNIup_memoryT$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_memoryT, "Results/DE/GO_PSCNIup_memoryT.csv")
write.csv(GO_PSCIup_memoryT, "Results/DE/GO_PSCIup_memoryT.csv")

PSCINI_CD8T <- FindMarkers(data_PSC, subset.ident = "CD8T", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_CD8T <- filter(PSCINI_CD8T, PSCINI_CD8T$p_val_adj < 0.05)
PSCINI_CD8T$cluster = ifelse(PSCINI_CD8T$avg_logFC > 0,"I","NI")
PSCINI_CD8T$gene = rownames(PSCINI_CD8T)
PSCIup_CD8T = filter(PSCINI_CD8T, PSCINI_CD8T$cluster == "I")
PSCNIup_CD8T = filter(PSCINI_CD8T, PSCINI_CD8T$cluster == "NI")
write.csv(PSCIup_CD8T, "Results/DE/PSCIup_CD8T.csv")
write.csv(PSCNIup_CD8T, "Results/DE/PSCNIup_CD8T.csv")
GO_PSCIup_CD8T=enrichr(PSCIup_CD8T$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_CD8T <- filter(GO_PSCIup_CD8T, GO_PSCIup_CD8T$Adjusted.P.value< 0.05)
GO_PSCNIup_CD8T=enrichr(PSCNIup_CD8T$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_CD8T <- filter(GO_PSCNIup_CD8T, GO_PSCNIup_CD8T$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_CD8T, "Results/DE/GO_PSCNIup_CD8T.csv")
write.csv(GO_PSCIup_CD8T, "Results/DE/GO_PSCIup_CD8T.csv")

PSCINI_T_activated_FOShi <- FindMarkers(data_PSC, subset.ident = "T_activated_FOS_high", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_T_activated_FOShi <- filter(PSCINI_T_activated_FOShi, PSCINI_T_activated_FOShi$p_val_adj < 0.05)
PSCINI_T_activated_FOShi$cluster = ifelse(PSCINI_T_activated_FOShi$avg_logFC > 0,"I","NI")
PSCINI_T_activated_FOShi$gene = rownames(PSCINI_T_activated_FOShi)
PSCIup_T_activated_FOShi = filter(PSCINI_T_activated_FOShi, PSCINI_T_activated_FOShi$cluster == "I")
PSCNIup_T_activated_FOShi = filter(PSCINI_T_activated_FOShi, PSCINI_T_activated_FOShi$cluster == "NI")
write.csv(PSCIup_T_activated_FOShi, "Results/DE/PSCIup_T_activated_FOShi.csv")
write.csv(PSCNIup_T_activated_FOShi, "Results/DE/PSCNIup_T_activated_FOShi.csv")
GO_PSCIup_T_activated_FOShi=enrichr(PSCIup_T_activated_FOShi$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_T_activated_FOShi <- filter(GO_PSCIup_T_activated_FOShi, GO_PSCIup_T_activated_FOShi$Adjusted.P.value< 0.05)
GO_PSCNIup_T_activated_FOShi=enrichr(PSCNIup_T_activated_FOShi$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_T_activated_FOShi <- filter(GO_PSCNIup_T_activated_FOShi, GO_PSCNIup_T_activated_FOShi$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_T_activated_FOShi, "Results/DE/GO_PSCNIup_T_activated_FOShi.csv")
write.csv(GO_PSCIup_T_activated_FOShi, "Results/DE/GO_PSCIup_T_activated_FOShi.csv")

PSCINI_GC <- FindMarkers(data_PSC, subset.ident = "GC", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_GC <- filter(PSCINI_GC, PSCINI_GC$p_val_adj < 0.05)
PSCINI_GC$cluster = ifelse(PSCINI_GC$avg_logFC > 0,"I","NI")
PSCINI_GC$gene = rownames(PSCINI_GC)
PSCIup_GC = filter(PSCINI_GC, PSCINI_GC$cluster == "I")
PSCNIup_GC = filter(PSCINI_GC, PSCINI_GC$cluster == "NI")
write.csv(PSCIup_GC, "Results/DE/PSCIup_GC.csv")
write.csv(PSCNIup_GC, "Results/DE/PSCNIup_GC.csv")
GO_PSCIup_GC=enrichr(PSCIup_GC$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_GC <- filter(GO_PSCIup_GC, GO_PSCIup_GC$Adjusted.P.value< 0.05)
GO_PSCNIup_GC=enrichr(PSCNIup_GC$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_GC <- filter(GO_PSCNIup_GC, GO_PSCNIup_GC$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_GC, "Results/DE/GO_PSCNIup_GC.csv")
write.csv(GO_PSCIup_GC, "Results/DE/GO_PSCIup_GC.csv")

PSCINI_Cycling_B <- FindMarkers(data_PSC, subset.ident = "Cycling_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Cycling_B <- filter(PSCINI_Cycling_B, PSCINI_Cycling_B$p_val_adj < 0.05)
PSCINI_Cycling_B$cluster = ifelse(PSCINI_Cycling_B$avg_logFC > 0,"I","NI")
PSCINI_Cycling_B$gene = rownames(PSCINI_Cycling_B)
PSCIup_Cycling_B = filter(PSCINI_Cycling_B, PSCINI_Cycling_B$cluster == "I")
PSCNIup_Cycling_B = filter(PSCINI_Cycling_B, PSCINI_Cycling_B$cluster == "NI")
write.csv(PSCIup_Cycling_B, "Results/DE/PSCIup_Cycling_B.csv")
write.csv(PSCNIup_Cycling_B, "Results/DE/PSCNIup_Cycling_B.csv")
GO_PSCIup_Cycling_B=enrichr(PSCIup_Cycling_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Cycling_B <- filter(GO_PSCIup_Cycling_B, GO_PSCIup_Cycling_B$Adjusted.P.value< 0.05)
GO_PSCNIup_Cycling_B=enrichr(PSCNIup_Cycling_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Cycling_B <- filter(GO_PSCNIup_Cycling_B, GO_PSCNIup_Cycling_B$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Cycling_B, "Results/DE/GO_PSCNIup_Cycling_B.csv")
write.csv(GO_PSCIup_Cycling_B, "Results/DE/GO_PSCIup_Cycling_B.csv")

PSCINI_Cycling_T <- FindMarkers(data_PSC, subset.ident = "Cycling_T", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Cycling_T <- filter(PSCINI_Cycling_T, PSCINI_Cycling_T$p_val_adj < 0.05)
PSCINI_Cycling_T$cluster = ifelse(PSCINI_Cycling_T$avg_logFC > 0,"I","NI")
PSCINI_Cycling_T$gene = rownames(PSCINI_Cycling_T)
PSCIup_Cycling_T = filter(PSCINI_Cycling_T, PSCINI_Cycling_T$cluster == "I")
PSCNIup_Cycling_T = filter(PSCINI_Cycling_T, PSCINI_Cycling_T$cluster == "NI")
write.csv(PSCIup_Cycling_T, "Results/DE/PSCIup_Cycling_T.csv")
write.csv(PSCNIup_Cycling_T, "Results/DE/PSCNIup_Cycling_T.csv")
GO_PSCIup_Cycling_T=enrichr(PSCIup_Cycling_T$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Cycling_T <- filter(GO_PSCIup_Cycling_T, GO_PSCIup_Cycling_T$Adjusted.P.value< 0.05)
GO_PSCNIup_Cycling_T=enrichr(PSCNIup_Cycling_T$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Cycling_T <- filter(GO_PSCNIup_Cycling_T, GO_PSCNIup_Cycling_T$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Cycling_T, "Results/DE/GO_PSCNIup_Cycling_T.csv")
write.csv(GO_PSCIup_Cycling_T, "Results/DE/GO_PSCIup_Cycling_T.csv")

PSCINI_IgM <- FindMarkers(data_PSC, subset.ident = "IgM_plasma", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_IgM <- filter(PSCINI_IgM, PSCINI_IgM$p_val_adj < 0.05)
PSCINI_IgM$cluster = ifelse(PSCINI_IgM$avg_logFC > 0,"I","NI")
PSCINI_IgM$gene = rownames(PSCINI_IgM)
PSCIup_IgM = filter(PSCINI_IgM, PSCINI_IgM$cluster == "I")
PSCNIup_IgM = filter(PSCINI_IgM, PSCINI_IgM$cluster == "NI")
write.csv(PSCIup_IgM, "Results/DE/PSCIup_IgM.csv")
write.csv(PSCNIup_IgM, "Results/DE/PSCNIup_IgM.csv")
GO_PSCIup_IgM=enrichr(PSCIup_IgM$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_IgM <- filter(GO_PSCIup_IgM, GO_PSCIup_IgM$Adjusted.P.value< 0.05)
GO_PSCNIup_IgM=enrichr(PSCNIup_IgM$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_IgM <- filter(GO_PSCNIup_IgM, GO_PSCNIup_IgM$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_IgM, "Results/DE/GO_PSCNIup_IgM.csv")
write.csv(GO_PSCIup_IgM, "Results/DE/GO_PSCIup_IgM.csv")

PSCINI_imm_entero <- FindMarkers(data_PSC, subset.ident = "Immature_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_imm_entero <- filter(PSCINI_imm_entero, PSCINI_imm_entero$p_val_adj < 0.05)
PSCINI_imm_entero$cluster = ifelse(PSCINI_imm_entero$avg_logFC > 0,"I","NI")
PSCINI_imm_entero$gene = rownames(PSCINI_imm_entero)
PSCIup_imm_entero = filter(PSCINI_imm_entero, PSCINI_imm_entero$cluster == "I")
PSCNIup_imm_entero = filter(PSCINI_imm_entero, PSCINI_imm_entero$cluster == "NI")
write.csv(PSCIup_imm_entero, "Results/DE/PSCIup_imm_entero.csv")
write.csv(PSCNIup_imm_entero, "Results/DE/PSCNIup_imm_entero.csv")
GO_PSCIup_imm_entero=enrichr(PSCIup_imm_entero$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_imm_entero <- filter(GO_PSCIup_imm_entero, GO_PSCIup_imm_entero$Adjusted.P.value< 0.05)
GO_PSCNIup_imm_entero=enrichr(PSCNIup_imm_entero$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_imm_entero <- filter(GO_PSCNIup_imm_entero, GO_PSCNIup_imm_entero$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_imm_entero, "Results/DE/GO_PSCNIup_imm_entero.csv")
write.csv(GO_PSCIup_imm_entero, "Results/DE/GO_PSCIup_imm_entero.csv")

PSCINI_Cycling_TA <- FindMarkers(data_PSC, subset.ident = "Cycling_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Cycling_TA <- filter(PSCINI_Cycling_TA, PSCINI_Cycling_TA$p_val_adj < 0.05)
PSCINI_Cycling_TA$cluster = ifelse(PSCINI_Cycling_TA$avg_logFC > 0,"I","NI")
PSCINI_Cycling_TA$gene = rownames(PSCINI_Cycling_TA)
PSCIup_Cycling_TA = filter(PSCINI_Cycling_TA, PSCINI_Cycling_TA$cluster == "I")
PSCNIup_Cycling_TA = filter(PSCINI_Cycling_TA, PSCINI_Cycling_TA$cluster == "NI")
write.csv(PSCIup_Cycling_TA, "Results/DE/PSCIup_Cycling_TA.csv")
write.csv(PSCNIup_Cycling_TA, "Results/DE/PSCNIup_Cycling_TA.csv")
GO_PSCIup_Cycling_TA=enrichr(PSCIup_Cycling_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Cycling_TA <- filter(GO_PSCIup_Cycling_TA, GO_PSCIup_Cycling_TA$Adjusted.P.value< 0.05)
GO_PSCNIup_Cycling_TA=enrichr(PSCNIup_Cycling_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Cycling_TA <- filter(GO_PSCNIup_Cycling_TA, GO_PSCNIup_Cycling_TA$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Cycling_TA, "Results/DE/GO_PSCNIup_Cycling_TA.csv")
write.csv(GO_PSCIup_Cycling_TA, "Results/DE/GO_PSCIup_Cycling_TA.csv")

PSCINI_Ribo_TA <- FindMarkers(data_PSC, subset.ident = "Ribo_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Ribo_TA <- filter(PSCINI_Ribo_TA, PSCINI_Ribo_TA$p_val_adj < 0.05)
PSCINI_Ribo_TA$cluster = ifelse(PSCINI_Ribo_TA$avg_logFC > 0,"I","NI")
PSCINI_Ribo_TA$gene = rownames(PSCINI_Ribo_TA)
PSCIup_Ribo_TA = filter(PSCINI_Ribo_TA, PSCINI_Ribo_TA$cluster == "I")
PSCNIup_Ribo_TA = filter(PSCINI_Ribo_TA, PSCINI_Ribo_TA$cluster == "NI")
write.csv(PSCIup_Ribo_TA, "Results/DE/PSCIup_Ribo_TA.csv")
write.csv(PSCNIup_Ribo_TA, "Results/DE/PSCNIup_Ribo_TA.csv")
GO_PSCIup_Ribo_TA=enrichr(PSCIup_Ribo_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Ribo_TA <- filter(GO_PSCIup_Ribo_TA, GO_PSCIup_Ribo_TA$Adjusted.P.value< 0.05)
GO_PSCNIup_Ribo_TA=enrichr(PSCNIup_Ribo_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Ribo_TA <- filter(GO_PSCNIup_Ribo_TA, GO_PSCNIup_Ribo_TA$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Ribo_TA, "Results/DE/GO_PSCNIup_Ribo_TA.csv")
write.csv(GO_PSCIup_Ribo_TA, "Results/DE/GO_PSCIup_Ribo_TA.csv")

PSCINI_BEST4 <- FindMarkers(data_PSC, subset.ident = "BEST4_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_BEST4 <- filter(PSCINI_BEST4, PSCINI_BEST4$p_val_adj < 0.05)
PSCINI_BEST4$cluster = ifelse(PSCINI_BEST4$avg_logFC > 0,"I","NI")
PSCINI_BEST4$gene = rownames(PSCINI_BEST4)
PSCIup_BEST4 = filter(PSCINI_BEST4, PSCINI_BEST4$cluster == "I")
PSCNIup_BEST4 = filter(PSCINI_BEST4, PSCINI_BEST4$cluster == "NI")
write.csv(PSCIup_BEST4, "Results/DE/PSCIup_BEST4.csv")
write.csv(PSCNIup_BEST4, "Results/DE/PSCNIup_BEST4.csv")
GO_PSCIup_BEST4=enrichr(PSCIup_BEST4$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_BEST4 <- filter(GO_PSCIup_BEST4, GO_PSCIup_BEST4$Adjusted.P.value< 0.05)
GO_PSCNIup_BEST4=enrichr(PSCNIup_BEST4$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_BEST4 <- filter(GO_PSCNIup_BEST4, GO_PSCNIup_BEST4$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_BEST4, "Results/DE/GO_PSCNIup_BEST4.csv")
write.csv(GO_PSCIup_BEST4, "Results/DE/GO_PSCIup_BEST4.csv")

PSCINI_imm_goblet <- FindMarkers(data_PSC, subset.ident = "Immature_goblet", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_imm_goblet <- filter(PSCINI_imm_goblet, PSCINI_imm_goblet$p_val_adj < 0.05)
PSCINI_imm_goblet$cluster = ifelse(PSCINI_imm_goblet$avg_logFC > 0,"I","NI")
PSCINI_imm_goblet$gene = rownames(PSCINI_imm_goblet)
PSCIup_imm_goblet = filter(PSCINI_imm_goblet, PSCINI_imm_goblet$cluster == "I")
PSCNIup_imm_goblet = filter(PSCINI_imm_goblet, PSCINI_imm_goblet$cluster == "NI")
write.csv(PSCIup_imm_goblet, "Results/DE/PSCIup_imm_goblet.csv")
write.csv(PSCNIup_imm_goblet, "Results/DE/PSCNIup_imm_goblet.csv")
GO_PSCIup_imm_goblet=enrichr(PSCIup_imm_goblet$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_imm_goblet <- filter(GO_PSCIup_imm_goblet, GO_PSCIup_imm_goblet$Adjusted.P.value< 0.05)
GO_PSCNIup_imm_goblet=enrichr(PSCNIup_imm_goblet$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_imm_goblet <- filter(GO_PSCNIup_imm_goblet, GO_PSCNIup_imm_goblet$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_imm_goblet, "Results/DE/GO_PSCNIup_imm_goblet.csv")
write.csv(GO_PSCIup_imm_goblet, "Results/DE/GO_PSCIup_imm_goblet.csv")

PSCINI_DUOX2 <- FindMarkers(data_PSC, subset.ident = "DUOX2_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_DUOX2 <- filter(PSCINI_DUOX2, PSCINI_DUOX2$p_val_adj < 0.05)
PSCINI_DUOX2$cluster = ifelse(PSCINI_DUOX2$avg_logFC > 0,"I","NI")
PSCINI_DUOX2$gene = rownames(PSCINI_DUOX2)
PSCIup_DUOX2 = filter(PSCINI_DUOX2, PSCINI_DUOX2$cluster == "I")
PSCNIup_DUOX2 = filter(PSCINI_DUOX2, PSCINI_DUOX2$cluster == "NI")
write.csv(PSCIup_DUOX2, "Results/DE/PSCIup_DUOX2.csv")
write.csv(PSCNIup_DUOX2, "Results/DE/PSCNIup_DUOX2.csv")
GO_PSCIup_DUOX2=enrichr(PSCIup_DUOX2$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_DUOX2 <- filter(GO_PSCIup_DUOX2, GO_PSCIup_DUOX2$Adjusted.P.value< 0.05)
GO_PSCNIup_DUOX2=enrichr(PSCNIup_DUOX2$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_DUOX2 <- filter(GO_PSCNIup_DUOX2, GO_PSCNIup_DUOX2$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_DUOX2, "Results/DE/GO_PSCNIup_DUOX2.csv")
write.csv(GO_PSCIup_DUOX2, "Results/DE/GO_PSCIup_DUOX2.csv")

PSCINI_PLCG2_TA <- FindMarkers(data_PSC, subset.ident = "PLCG2_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_PLCG2_TA <- filter(PSCINI_PLCG2_TA, PSCINI_PLCG2_TA$p_val_adj < 0.05)
PSCINI_PLCG2_TA$cluster = ifelse(PSCINI_PLCG2_TA$avg_logFC > 0,"I","NI")
PSCINI_PLCG2_TA$gene = rownames(PSCINI_PLCG2_TA)
PSCIup_PLCG2_TA = filter(PSCINI_PLCG2_TA, PSCINI_PLCG2_TA$cluster == "I")
PSCNIup_PLCG2_TA = filter(PSCINI_PLCG2_TA, PSCINI_PLCG2_TA$cluster == "NI")
write.csv(PSCIup_PLCG2_TA, "Results/DE/PSCIup_PLCG2_TA.csv")
write.csv(PSCNIup_PLCG2_TA, "Results/DE/PSCNIup_PLCG2_TA.csv")
GO_PSCIup_PLCG2_TA=enrichr(PSCIup_PLCG2_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_PLCG2_TA <- filter(GO_PSCIup_PLCG2_TA, GO_PSCIup_PLCG2_TA$Adjusted.P.value< 0.05)
GO_PSCNIup_PLCG2_TA=enrichr(PSCNIup_PLCG2_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_PLCG2_TA <- filter(GO_PSCNIup_PLCG2_TA, GO_PSCNIup_PLCG2_TA$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_PLCG2_TA, "Results/DE/GO_PSCNIup_PLCG2_TA.csv")
write.csv(GO_PSCIup_PLCG2_TA, "Results/DE/GO_PSCIup_PLCG2_TA.csv")

PSCINI_Absorptive_TA <- FindMarkers(data_PSC, subset.ident = "Absorptive_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Absorptive_TA <- filter(PSCINI_Absorptive_TA, PSCINI_Absorptive_TA$p_val_adj < 0.05)
PSCINI_Absorptive_TA$cluster = ifelse(PSCINI_Absorptive_TA$avg_logFC > 0,"I","NI")
PSCINI_Absorptive_TA$gene = rownames(PSCINI_Absorptive_TA)
PSCIup_Absorptive_TA = filter(PSCINI_Absorptive_TA, PSCINI_Absorptive_TA$cluster == "I")
PSCNIup_Absorptive_TA = filter(PSCINI_Absorptive_TA, PSCINI_Absorptive_TA$cluster == "NI")
write.csv(PSCIup_Absorptive_TA, "Results/DE/PSCIup_Absorptive_TA.csv")
write.csv(PSCNIup_Absorptive_TA, "Results/DE/PSCNIup_Absorptive_TA.csv")
GO_PSCIup_Absorptive_TA=enrichr(PSCIup_Absorptive_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Absorptive_TA <- filter(GO_PSCIup_Absorptive_TA, GO_PSCIup_Absorptive_TA$Adjusted.P.value< 0.05)
GO_PSCNIup_Absorptive_TA=enrichr(PSCNIup_Absorptive_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Absorptive_TA <- filter(GO_PSCNIup_Absorptive_TA, GO_PSCNIup_Absorptive_TA$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Absorptive_TA, "Results/DE/GO_PSCNIup_Absorptive_TA.csv")
write.csv(GO_PSCIup_Absorptive_TA, "Results/DE/GO_PSCIup_Absorptive_TA.csv")

PSCINI_Tuft <- FindMarkers(data_PSC, subset.ident = "Tuft", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_Tuft <- filter(PSCINI_Tuft, PSCINI_Tuft$p_val_adj < 0.05)
PSCINI_Tuft$cluster = ifelse(PSCINI_Tuft$avg_logFC > 0,"I","NI")
PSCINI_Tuft$gene = rownames(PSCINI_Tuft)
PSCIup_Tuft = filter(PSCINI_Tuft, PSCINI_Tuft$cluster == "I")
PSCNIup_Tuft = filter(PSCINI_Tuft, PSCINI_Tuft$cluster == "NI")
write.csv(PSCIup_Tuft, "Results/DE/PSCIup_Tuft.csv")
write.csv(PSCNIup_Tuft, "Results/DE/PSCNIup_Tuft.csv")
GO_PSCIup_Tuft=enrichr(PSCIup_Tuft$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_Tuft <- filter(GO_PSCIup_Tuft, GO_PSCIup_Tuft$Adjusted.P.value< 0.05)
GO_PSCNIup_Tuft=enrichr(PSCNIup_Tuft$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_Tuft <- filter(GO_PSCNIup_Tuft, GO_PSCNIup_Tuft$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_Tuft, "Results/DE/GO_PSCNIup_Tuft.csv")
write.csv(GO_PSCIup_Tuft, "Results/DE/GO_PSCIup_Tuft.csv")

PSCINI_REG_TA <- FindMarkers(data_PSC, subset.ident = "REG_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
PSCINI_REG_TA <- filter(PSCINI_REG_TA, PSCINI_REG_TA$p_val_adj < 0.05)
PSCINI_REG_TA$cluster = ifelse(PSCINI_REG_TA$avg_logFC > 0,"I","NI")
PSCINI_REG_TA$gene = rownames(PSCINI_REG_TA)
PSCIup_REG_TA = filter(PSCINI_REG_TA, PSCINI_REG_TA$cluster == "I")
PSCNIup_REG_TA = filter(PSCINI_REG_TA, PSCINI_REG_TA$cluster == "NI")
write.csv(PSCIup_REG_TA, "Results/DE/PSCIup_REG_TA.csv")
write.csv(PSCNIup_REG_TA, "Results/DE/PSCNIup_REG_TA.csv")
GO_PSCIup_REG_TA=enrichr(PSCIup_REG_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCIup_REG_TA <- filter(GO_PSCIup_REG_TA, GO_PSCIup_REG_TA$Adjusted.P.value< 0.05)
GO_PSCNIup_REG_TA=enrichr(PSCNIup_REG_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_PSCNIup_REG_TA <- filter(GO_PSCNIup_REG_TA, GO_PSCNIup_REG_TA$Adjusted.P.value< 0.05)
write.csv(GO_PSCNIup_REG_TA, "Results/DE/GO_PSCNIup_REG_TA.csv")
write.csv(GO_PSCIup_REG_TA, "Results/DE/GO_PSCIup_REG_TA.csv")


# Paired test UC
Idents(data)="sample"
data_UC= subset(data, ident = c("3006","3059","3076","3085","3107","3125","3249"))

Idents(data_UC) = "celltypes"
UCINI_IgG <- FindMarkers(data_UC, subset.ident = "IgG_plasma", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_IgG <- filter(UCINI_IgG, UCINI_IgG$p_val_adj < 0.05)
UCINI_IgG$cluster = ifelse(UCINI_IgG$avg_logFC > 0,"I","NI")
UCINI_IgG$gene = rownames(UCINI_IgG)
UCIup_IgG = filter(UCINI_IgG, UCINI_IgG$cluster == "I")
UCNIup_IgG = filter(UCINI_IgG, UCINI_IgG$cluster == "NI")
write.csv(UCIup_IgG, "Results/DE/UCIup_IgG.csv")
write.csv(UCNIup_IgG, "Results/DE/UCNIup_IgG.csv")
GO_UCIup_IgG=enrichr(UCIup_IgG$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_IgG <- filter(GO_UCIup_IgG, GO_UCIup_IgG$Adjusted.P.value< 0.05)
GO_UCNIup_IgG=enrichr(UCNIup_IgG$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_IgG <- filter(GO_UCNIup_IgG, GO_UCNIup_IgG$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_IgG, "Results/DE/GO_UCNIup_IgG.csv")
write.csv(GO_UCIup_IgG, "Results/DE/GO_UCIup_IgG.csv")

UCINI_Treg <- FindMarkers(data_UC, subset.ident = "Treg", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Treg <- filter(UCINI_Treg, UCINI_Treg$p_val_adj < 0.05)
UCINI_Treg$cluster = ifelse(UCINI_Treg$avg_logFC > 0,"I","NI")
UCINI_Treg$gene = rownames(UCINI_Treg)
UCIup_Treg = filter(UCINI_Treg, UCINI_Treg$cluster == "I")
UCNIup_Treg = filter(UCINI_Treg, UCINI_Treg$cluster == "NI")
write.csv(UCIup_Treg, "Results/DE/UCIup_Treg.csv")
write.csv(UCNIup_Treg, "Results/DE/UCNIup_Treg.csv")
GO_UCIup_Treg=enrichr(UCIup_Treg$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Treg <- filter(GO_UCIup_Treg, GO_UCIup_Treg$Adjusted.P.value< 0.05)
GO_UCNIup_Treg=enrichr(UCNIup_Treg$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Treg <- filter(GO_UCNIup_Treg, GO_UCNIup_Treg$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Treg, "Results/DE/GO_UCNIup_Treg.csv")
write.csv(GO_UCIup_Treg, "Results/DE/GO_UCIup_Treg.csv")

UCINI_ActivatedT_FOSlow <- FindMarkers(data_UC, subset.ident = "T_activated_FOS_low", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_ActivatedT_FOSlow <- filter(UCINI_ActivatedT_FOSlow, UCINI_ActivatedT_FOSlow$p_val_adj < 0.05)
UCINI_ActivatedT_FOSlow$cluster = ifelse(UCINI_ActivatedT_FOSlow$avg_logFC > 0,"I","NI")
UCINI_ActivatedT_FOSlow$gene = rownames(UCINI_ActivatedT_FOSlow)
UCIup_ActivatedT_FOSlow = filter(UCINI_ActivatedT_FOSlow, UCINI_ActivatedT_FOSlow$cluster == "I")
UCNIup_ActivatedT_FOSlow = filter(UCINI_ActivatedT_FOSlow, UCINI_ActivatedT_FOSlow$cluster == "NI")
write.csv(UCIup_ActivatedT_FOSlow, "Results/DE/UCIup_ActivatedT_FOSlow.csv")
write.csv(UCNIup_ActivatedT_FOSlow, "Results/DE/UCNIup_ActivatedT_FOSlow.csv")
GO_UCIup_ActivatedT_FOSlow=enrichr(UCIup_ActivatedT_FOSlow$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_ActivatedT_FOSlow <- filter(GO_UCIup_ActivatedT_FOSlow, GO_UCIup_ActivatedT_FOSlow$Adjusted.P.value< 0.05)
GO_UCNIup_ActivatedT_FOSlow=enrichr(UCNIup_ActivatedT_FOSlow$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_ActivatedT_FOSlow <- filter(GO_UCNIup_ActivatedT_FOSlow, GO_UCNIup_ActivatedT_FOSlow$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_ActivatedT_FOSlow, "Results/DE/GO_UCNIup_ActivatedT_FOSlow.csv")
write.csv(GO_UCIup_ActivatedT_FOSlow, "Results/DE/GO_UCIup_ActivatedT_FOSlow.csv")

UCINI_APC <- FindMarkers(data_UC, subset.ident = "APC", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_APC <- filter(UCINI_APC, UCINI_APC$p_val_adj < 0.05)
UCINI_APC$cluster = ifelse(UCINI_APC$avg_logFC > 0,"I","NI")
UCINI_APC$gene = rownames(UCINI_APC)
UCIup_APC = filter(UCINI_APC, UCINI_APC$cluster == "I")
UCNIup_APC = filter(UCINI_APC, UCINI_APC$cluster == "NI")
write.csv(UCIup_APC, "Results/DE/UCIup_APC.csv")
write.csv(UCNIup_APC, "Results/DE/UCNIup_APC.csv")
GO_UCIup_APC=enrichr(UCIup_APC$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_APC <- filter(GO_UCIup_APC, GO_UCIup_APC$Adjusted.P.value< 0.05)
GO_UCNIup_APC=enrichr(UCNIup_APC$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_APC <- filter(GO_UCNIup_APC, GO_UCNIup_APC$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_APC, "Results/DE/GO_UCNIup_APC.csv")
write.csv(GO_UCIup_APC, "Results/DE/GO_UCIup_APC.csv")

UCINI_Follicular <- FindMarkers(data_UC, subset.ident = "Follicular_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Follicular <- filter(UCINI_Follicular, UCINI_Follicular$p_val_adj < 0.05)
UCINI_Follicular$cluster = ifelse(UCINI_Follicular$avg_logFC > 0,"I","NI")
UCINI_Follicular$gene = rownames(UCINI_Follicular)
UCIup_Follicular = filter(UCINI_Follicular, UCINI_Follicular$cluster == "I")
UCNIup_Follicular = filter(UCINI_Follicular, UCINI_Follicular$cluster == "NI")
write.csv(UCIup_Follicular, "Results/DE/UCIup_Follicular.csv")
write.csv(UCNIup_Follicular, "Results/DE/UCNIup_Follicular.csv")
GO_UCIup_Follicular=enrichr(UCIup_Follicular$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Follicular <- filter(GO_UCIup_Follicular, GO_UCIup_Follicular$Adjusted.P.value< 0.05)
GO_UCNIup_Follicular=enrichr(UCNIup_Follicular$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Follicular <- filter(GO_UCNIup_Follicular, GO_UCNIup_Follicular$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Follicular, "Results/DE/GO_UCNIup_Follicular.csv")
write.csv(GO_UCIup_Follicular, "Results/DE/GO_UCIup_Follicular.csv")

UCINI_IgA <- FindMarkers(data_UC, subset.ident = "IgA_plasma", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_IgA <- filter(UCINI_IgA, UCINI_IgA$p_val_adj < 0.05)
UCINI_IgA$cluster = ifelse(UCINI_IgA$avg_logFC > 0,"I","NI")
UCINI_IgA$gene = rownames(UCINI_IgA)
UCIup_IgA = filter(UCINI_IgA, UCINI_IgA$cluster == "I")
UCNIup_IgA = filter(UCINI_IgA, UCINI_IgA$cluster == "NI")
write.csv(UCIup_IgA, "Results/DE/UCIup_IgA.csv")
write.csv(UCNIup_IgA, "Results/DE/UCNIup_IgA.csv")
GO_UCIup_IgA=enrichr(UCIup_IgA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_IgA <- filter(GO_UCIup_IgA, GO_UCIup_IgA$Adjusted.P.value< 0.05)
GO_UCNIup_IgA=enrichr(UCNIup_IgA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_IgA <- filter(GO_UCNIup_IgA, GO_UCNIup_IgA$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_IgA, "Results/DE/GO_UCNIup_IgA.csv")
write.csv(GO_UCIup_IgA, "Results/DE/GO_UCIup_IgA.csv")

UCINI_Inflam_fibro <- FindMarkers(data_UC, subset.ident = "Inflammatory_fibroblast", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Inflam_fibro <- filter(UCINI_Inflam_fibro, UCINI_Inflam_fibro$p_val_adj < 0.05)
UCINI_Inflam_fibro$cluster = ifelse(UCINI_Inflam_fibro$avg_logFC > 0,"I","NI")
UCINI_Inflam_fibro$gene = rownames(UCINI_Inflam_fibro)
UCIup_Inflam_fibro = filter(UCINI_Inflam_fibro, UCINI_Inflam_fibro$cluster == "I")
UCNIup_Inflam_fibro = filter(UCINI_Inflam_fibro, UCINI_Inflam_fibro$cluster == "NI")
write.csv(UCIup_Inflam_fibro, "Results/DE/UCIup_Inflam_fibro.csv")
write.csv(UCNIup_Inflam_fibro, "Results/DE/UCNIup_Inflam_fibro.csv")
GO_UCIup_Inflam_fibro=enrichr(UCIup_Inflam_fibro$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Inflam_fibro <- filter(GO_UCIup_Inflam_fibro, GO_UCIup_Inflam_fibro$Adjusted.P.value< 0.05)
GO_UCNIup_Inflam_fibro=enrichr(UCNIup_Inflam_fibro$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Inflam_fibro <- filter(GO_UCNIup_Inflam_fibro, GO_UCNIup_Inflam_fibro$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Inflam_fibro, "Results/DE/GO_UCNIup_Inflam_fibro.csv")
write.csv(GO_UCIup_Inflam_fibro, "Results/DE/GO_UCIup_Inflam_fibro.csv")

UCINI_abs_entero <- FindMarkers(data_UC, subset.ident = "Absorptive_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_abs_entero <- filter(UCINI_abs_entero, UCINI_abs_entero$p_val_adj < 0.05)
UCINI_abs_entero$cluster = ifelse(UCINI_abs_entero$avg_logFC > 0,"I","NI")
UCINI_abs_entero$gene = rownames(UCINI_abs_entero)
UCIup_abs_entero = filter(UCINI_abs_entero, UCINI_abs_entero$cluster == "I")
UCNIup_abs_entero = filter(UCINI_abs_entero, UCINI_abs_entero$cluster == "NI")
write.csv(UCIup_abs_entero, "Results/DE/UCIup_abs_entero.csv")
write.csv(UCNIup_abs_entero, "Results/DE/UCNIup_abs_entero.csv")
GO_UCIup_abs_entero=enrichr(UCIup_abs_entero$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_abs_entero <- filter(GO_UCIup_abs_entero, GO_UCIup_abs_entero$Adjusted.P.value< 0.05)
GO_UCNIup_abs_entero=enrichr(UCNIup_abs_entero$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_abs_entero <- filter(GO_UCNIup_abs_entero, GO_UCNIup_abs_entero$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_abs_entero, "Results/DE/GO_UCNIup_abs_entero.csv")
write.csv(GO_UCIup_abs_entero, "Results/DE/GO_UCIup_abs_entero.csv")

UCINI_stem <- FindMarkers(data_UC, subset.ident = "Stem", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_stem <- filter(UCINI_stem, UCINI_stem$p_val_adj < 0.05)
UCINI_stem$cluster = ifelse(UCINI_stem$avg_logFC > 0,"I","NI")
UCINI_stem$gene = rownames(UCINI_stem)
UCIup_stem = filter(UCINI_stem, UCINI_stem$cluster == "I")
UCNIup_stem = filter(UCINI_stem, UCINI_stem$cluster == "NI")
write.csv(UCIup_stem, "Results/DE/UCIup_stem.csv")
write.csv(UCNIup_stem, "Results/DE/UCNIup_stem.csv")
GO_UCIup_stem=enrichr(UCIup_stem$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_stem <- filter(GO_UCIup_stem, GO_UCIup_stem$Adjusted.P.value< 0.05)
GO_UCNIup_stem=enrichr(UCNIup_stem$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_stem <- filter(GO_UCNIup_stem, GO_UCNIup_stem$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_stem, "Results/DE/GO_UCNIup_stem.csv")
write.csv(GO_UCIup_stem, "Results/DE/GO_UCIup_stem.csv")

UCINI_Enteroendocrine <- FindMarkers(data_UC, subset.ident = "Enteroendocrine", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Enteroendocrine <- filter(UCINI_Enteroendocrine, UCINI_Enteroendocrine$p_val_adj < 0.05)
UCINI_Enteroendocrine$cluster = ifelse(UCINI_Enteroendocrine$avg_logFC > 0,"I","NI")
UCINI_Enteroendocrine$gene = rownames(UCINI_Enteroendocrine)
UCIup_Enteroendocrine = filter(UCINI_Enteroendocrine, UCINI_Enteroendocrine$cluster == "I")
UCNIup_Enteroendocrine = filter(UCINI_Enteroendocrine, UCINI_Enteroendocrine$cluster == "NI")
write.csv(UCIup_Enteroendocrine, "Results/DE/UCIup_Enteroendocrine.csv")
write.csv(UCNIup_Enteroendocrine, "Results/DE/UCNIup_Enteroendocrine.csv")
GO_UCIup_Enteroendocrine=enrichr(UCIup_Enteroendocrine$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Enteroendocrine <- filter(GO_UCIup_Enteroendocrine, GO_UCIup_Enteroendocrine$Adjusted.P.value< 0.05)
GO_UCNIup_Enteroendocrine=enrichr(UCNIup_Enteroendocrine$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Enteroendocrine <- filter(GO_UCNIup_Enteroendocrine, GO_UCNIup_Enteroendocrine$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Enteroendocrine, "Results/DE/GO_UCNIup_Enteroendocrine.csv")
write.csv(GO_UCIup_Enteroendocrine, "Results/DE/GO_UCIup_Enteroendocrine.csv")

UCINI_Goblet <- FindMarkers(data_UC, subset.ident = "Goblet", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Goblet <- filter(UCINI_Goblet, UCINI_Goblet$p_val_adj < 0.05)
UCINI_Goblet$cluster = ifelse(UCINI_Goblet$avg_logFC > 0,"I","NI")
UCINI_Goblet$gene = rownames(UCINI_Goblet)
UCIup_Goblet = filter(UCINI_Goblet, UCINI_Goblet$cluster == "I")
UCNIup_Goblet = filter(UCINI_Goblet, UCINI_Goblet$cluster == "NI")
write.csv(UCIup_Goblet, "Results/DE/UCIup_Goblet.csv")
write.csv(UCNIup_Goblet, "Results/DE/UCNIup_Goblet.csv")
GO_UCIup_Goblet=enrichr(UCIup_Goblet$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Goblet <- filter(GO_UCIup_Goblet, GO_UCIup_Goblet$Adjusted.P.value< 0.05)
GO_UCNIup_Goblet=enrichr(UCNIup_Goblet$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Goblet <- filter(GO_UCNIup_Goblet, GO_UCNIup_Goblet$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Goblet, "Results/DE/GO_UCNIup_Goblet.csv")
write.csv(GO_UCIup_Goblet, "Results/DE/GO_UCIup_Goblet.csv")

UCINI_MAST <- FindMarkers(data_UC, subset.ident = "MAST", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_MAST <- filter(UCINI_MAST, UCINI_MAST$p_val_adj < 0.05)
UCINI_MAST$cluster = ifelse(UCINI_MAST$avg_logFC > 0,"I","NI")
UCINI_MAST$gene = rownames(UCINI_MAST)
UCIup_MAST = filter(UCINI_MAST, UCINI_MAST$cluster == "I")
UCNIup_MAST = filter(UCINI_MAST, UCINI_MAST$cluster == "NI")
write.csv(UCIup_MAST, "Results/DE/UCIup_MAST.csv")
write.csv(UCNIup_MAST, "Results/DE/UCNIup_MAST.csv")
GO_UCIup_MAST=enrichr(UCIup_MAST$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_MAST <- filter(GO_UCIup_MAST, GO_UCIup_MAST$Adjusted.P.value< 0.05)
GO_UCNIup_MAST=enrichr(UCNIup_MAST$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_MAST <- filter(GO_UCNIup_MAST, GO_UCNIup_MAST$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_MAST, "Results/DE/GO_UCNIup_MAST.csv")
write.csv(GO_UCIup_MAST, "Results/DE/GO_UCIup_MAST.csv")

UCINI_RSPO3 <- FindMarkers(data_UC, subset.ident = "RSPO3+", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_RSPO3 <- filter(UCINI_RSPO3, UCINI_RSPO3$p_val_adj < 0.05)
UCINI_RSPO3$cluster = ifelse(UCINI_RSPO3$avg_logFC > 0,"I","NI")
UCINI_RSPO3$gene = rownames(UCINI_RSPO3)
UCIup_RSPO3 = filter(UCINI_RSPO3, UCINI_RSPO3$cluster == "I")
UCNIup_RSPO3 = filter(UCINI_RSPO3, UCINI_RSPO3$cluster == "NI")
write.csv(UCIup_RSPO3, "Results/DE/UCIup_RSPO3.csv")
write.csv(UCNIup_RSPO3, "Results/DE/UCNIup_RSPO3.csv")
GO_UCIup_RSPO3=enrichr(UCIup_RSPO3$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_RSPO3 <- filter(GO_UCIup_RSPO3, GO_UCIup_RSPO3$Adjusted.P.value< 0.05)
GO_UCNIup_RSPO3=enrichr(UCNIup_RSPO3$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_RSPO3 <- filter(GO_UCNIup_RSPO3, GO_UCNIup_RSPO3$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_RSPO3, "Results/DE/GO_UCNIup_RSPO3.csv")
write.csv(GO_UCIup_RSPO3, "Results/DE/GO_UCIup_RSPO3.csv")

UCINI_WNT2B <- FindMarkers(data_UC, subset.ident = "WNT2B+", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_WNT2B <- filter(UCINI_WNT2B, UCINI_WNT2B$p_val_adj < 0.05)
UCINI_WNT2B$cluster = ifelse(UCINI_WNT2B$avg_logFC > 0,"I","NI")
UCINI_WNT2B$gene = rownames(UCINI_WNT2B)
UCIup_WNT2B = filter(UCINI_WNT2B, UCINI_WNT2B$cluster == "I")
UCNIup_WNT2B = filter(UCINI_WNT2B, UCINI_WNT2B$cluster == "NI")
write.csv(UCIup_WNT2B, "Results/DE/UCIup_WNT2B.csv")
write.csv(UCNIup_WNT2B, "Results/DE/UCNIup_WNT2B.csv")
GO_UCIup_WNT2B=enrichr(UCIup_WNT2B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_WNT2B <- filter(GO_UCIup_WNT2B, GO_UCIup_WNT2B$Adjusted.P.value< 0.05)
GO_UCNIup_WNT2B=enrichr(UCNIup_WNT2B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_WNT2B <- filter(GO_UCNIup_WNT2B, GO_UCNIup_WNT2B$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_WNT2B, "Results/DE/GO_UCNIup_WNT2B.csv")
write.csv(GO_UCIup_WNT2B, "Results/DE/GO_UCIup_WNT2B.csv")

UCINI_WNT5B <- FindMarkers(data_UC, subset.ident = "WNT5B+", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_WNT5B <- filter(UCINI_WNT5B, UCINI_WNT5B$p_val_adj < 0.05)
UCINI_WNT5B$cluster = ifelse(UCINI_WNT5B$avg_logFC > 0,"I","NI")
UCINI_WNT5B$gene = rownames(UCINI_WNT5B)
UCIup_WNT5B = filter(UCINI_WNT5B, UCINI_WNT5B$cluster == "I")
UCNIup_WNT5B = filter(UCINI_WNT5B, UCINI_WNT5B$cluster == "NI")
write.csv(UCIup_WNT5B, "Results/DE/UCIup_WNT5B.csv")
write.csv(UCNIup_WNT5B, "Results/DE/UCNIup_WNT5B.csv")
GO_UCIup_WNT5B=enrichr(UCIup_WNT5B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_WNT5B <- filter(GO_UCIup_WNT5B, GO_UCIup_WNT5B$Adjusted.P.value< 0.05)
GO_UCNIup_WNT5B=enrichr(UCNIup_WNT5B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_WNT5B <- filter(GO_UCNIup_WNT5B, GO_UCNIup_WNT5B$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_WNT5B, "Results/DE/GO_UCNIup_WNT5B.csv")
write.csv(GO_UCIup_WNT5B, "Results/DE/GO_UCIup_WNT5B.csv")

UCINI_endothelial <- FindMarkers(data_UC, subset.ident = "endothelial", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_endothelial <- filter(UCINI_endothelial, UCINI_endothelial$p_val_adj < 0.05)
UCINI_endothelial$cluster = ifelse(UCINI_endothelial$avg_logFC > 0,"I","NI")
UCINI_endothelial$gene = rownames(UCINI_endothelial)
UCIup_endothelial = filter(UCINI_endothelial, UCINI_endothelial$cluster == "I")
UCNIup_endothelial = filter(UCINI_endothelial, UCINI_endothelial$cluster == "NI")
write.csv(UCIup_endothelial, "Results/DE/UCIup_endothelial.csv")
write.csv(UCNIup_endothelial, "Results/DE/UCNIup_endothelial.csv")
GO_UCIup_endothelial=enrichr(UCIup_endothelial$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_endothelial <- filter(GO_UCIup_endothelial, GO_UCIup_endothelial$Adjusted.P.value< 0.05)
GO_UCNIup_endothelial=enrichr(UCNIup_endothelial$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_endothelial <- filter(GO_UCNIup_endothelial, GO_UCNIup_endothelial$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_endothelial, "Results/DE/GO_UCNIup_endothelial.csv")
write.csv(GO_UCIup_endothelial, "Results/DE/GO_UCIup_endothelial.csv")

UCINI_pericyte <- FindMarkers(data_UC, subset.ident = "pericytes", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_pericyte <- filter(UCINI_pericyte, UCINI_pericyte$p_val_adj < 0.05)
UCINI_pericyte$cluster = ifelse(UCINI_pericyte$avg_logFC > 0,"I","NI")
UCINI_pericyte$gene = rownames(UCINI_pericyte)
UCIup_pericyte = filter(UCINI_pericyte, UCINI_pericyte$cluster == "I")
UCNIup_pericyte = filter(UCINI_pericyte, UCINI_pericyte$cluster == "NI")
write.csv(UCIup_pericyte, "Results/DE/UCIup_pericyte.csv")
write.csv(UCNIup_pericyte, "Results/DE/UCNIup_pericyte.csv")
GO_UCIup_pericyte=enrichr(UCIup_pericyte$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_pericyte <- filter(GO_UCIup_pericyte, GO_UCIup_pericyte$Adjusted.P.value< 0.05)
GO_UCNIup_pericyte=enrichr(UCNIup_pericyte$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_pericyte <- filter(GO_UCNIup_pericyte, GO_UCNIup_pericyte$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_pericyte, "Results/DE/GO_UCNIup_pericyte.csv")
write.csv(GO_UCIup_pericyte, "Results/DE/GO_UCIup_pericyte.csv")

UCINI_glia <- FindMarkers(data_UC, subset.ident = "glia", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_glia <- filter(UCINI_glia, UCINI_glia$p_val_adj < 0.05)
UCINI_glia$cluster = ifelse(UCINI_glia$avg_logFC > 0,"I","NI")
UCINI_glia$gene = rownames(UCINI_glia)
UCIup_glia = filter(UCINI_glia, UCINI_glia$cluster == "I")
UCNIup_glia = filter(UCINI_glia, UCINI_glia$cluster == "NI")
write.csv(UCIup_glia, "Results/DE/UCIup_glia.csv")
write.csv(UCNIup_glia, "Results/DE/UCNIup_glia.csv")
GO_UCIup_glia=enrichr(UCIup_glia$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_glia <- filter(GO_UCIup_glia, GO_UCIup_glia$Adjusted.P.value< 0.05)
GO_UCNIup_glia=enrichr(UCNIup_glia$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_glia <- filter(GO_UCNIup_glia, GO_UCNIup_glia$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_glia, "Results/DE/GO_UCNIup_glia.csv")
write.csv(GO_UCIup_glia, "Results/DE/GO_UCIup_glia.csv")

UCINI_myofibro <- FindMarkers(data_UC, subset.ident = "myofibroblasts", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_myofibro <- filter(UCINI_myofibro, UCINI_myofibro$p_val_adj < 0.05)
UCINI_myofibro$cluster = ifelse(UCINI_myofibro$avg_logFC > 0,"I","NI")
UCINI_myofibro$gene = rownames(UCINI_myofibro)
UCIup_myofibro = filter(UCINI_myofibro, UCINI_myofibro$cluster == "I")
UCNIup_myofibro = filter(UCINI_myofibro, UCINI_myofibro$cluster == "NI")
write.csv(UCIup_myofibro, "Results/DE/UCIup_myofibro.csv")
write.csv(UCNIup_myofibro, "Results/DE/UCNIup_myofibro.csv")
GO_UCIup_myofibro=enrichr(UCIup_myofibro$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_myofibro <- filter(GO_UCIup_myofibro, GO_UCIup_myofibro$Adjusted.P.value< 0.05)
GO_UCNIup_myofibro=enrichr(UCNIup_myofibro$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_myofibro <- filter(GO_UCNIup_myofibro, GO_UCNIup_myofibro$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_myofibro, "Results/DE/GO_UCNIup_myofibro.csv")
write.csv(GO_UCIup_myofibro, "Results/DE/GO_UCIup_myofibro.csv")

UCINI_memoryT <- FindMarkers(data_UC, subset.ident = "CD4_T_memory", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_memoryT <- filter(UCINI_memoryT, UCINI_memoryT$p_val_adj < 0.05)
UCINI_memoryT$cluster = ifelse(UCINI_memoryT$avg_logFC > 0,"I","NI")
UCINI_memoryT$gene = rownames(UCINI_memoryT)
UCIup_memoryT = filter(UCINI_memoryT, UCINI_memoryT$cluster == "I")
UCNIup_memoryT = filter(UCINI_memoryT, UCINI_memoryT$cluster == "NI")
write.csv(UCIup_memoryT, "Results/DE/UCIup_memoryT.csv")
write.csv(UCNIup_memoryT, "Results/DE/UCNIup_memoryT.csv")
GO_UCIup_memoryT=enrichr(UCIup_memoryT$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_memoryT <- filter(GO_UCIup_memoryT, GO_UCIup_memoryT$Adjusted.P.value< 0.05)
GO_UCNIup_memoryT=enrichr(UCNIup_memoryT$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_memoryT <- filter(GO_UCNIup_memoryT, GO_UCNIup_memoryT$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_memoryT, "Results/DE/GO_UCNIup_memoryT.csv")
write.csv(GO_UCIup_memoryT, "Results/DE/GO_UCIup_memoryT.csv")

UCINI_CD8T <- FindMarkers(data_UC, subset.ident = "CD8T", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_CD8T <- filter(UCINI_CD8T, UCINI_CD8T$p_val_adj < 0.05)
UCINI_CD8T$cluster = ifelse(UCINI_CD8T$avg_logFC > 0,"I","NI")
UCINI_CD8T$gene = rownames(UCINI_CD8T)
UCIup_CD8T = filter(UCINI_CD8T, UCINI_CD8T$cluster == "I")
UCNIup_CD8T = filter(UCINI_CD8T, UCINI_CD8T$cluster == "NI")
write.csv(UCIup_CD8T, "Results/DE/UCIup_CD8T.csv")
write.csv(UCNIup_CD8T, "Results/DE/UCNIup_CD8T.csv")
GO_UCIup_CD8T=enrichr(UCIup_CD8T$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_CD8T <- filter(GO_UCIup_CD8T, GO_UCIup_CD8T$Adjusted.P.value< 0.05)
GO_UCNIup_CD8T=enrichr(UCNIup_CD8T$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_CD8T <- filter(GO_UCNIup_CD8T, GO_UCNIup_CD8T$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_CD8T, "Results/DE/GO_UCNIup_CD8T.csv")
write.csv(GO_UCIup_CD8T, "Results/DE/GO_UCIup_CD8T.csv")

UCINI_T_activated_FOShi <- FindMarkers(data_UC, subset.ident = "T_activated_FOS_high", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_T_activated_FOShi <- filter(UCINI_T_activated_FOShi, UCINI_T_activated_FOShi$p_val_adj < 0.05)
UCINI_T_activated_FOShi$cluster = ifelse(UCINI_T_activated_FOShi$avg_logFC > 0,"I","NI")
UCINI_T_activated_FOShi$gene = rownames(UCINI_T_activated_FOShi)
UCIup_T_activated_FOShi = filter(UCINI_T_activated_FOShi, UCINI_T_activated_FOShi$cluster == "I")
UCNIup_T_activated_FOShi = filter(UCINI_T_activated_FOShi, UCINI_T_activated_FOShi$cluster == "NI")
write.csv(UCIup_T_activated_FOShi, "Results/DE/UCIup_T_activated_FOShi.csv")
write.csv(UCNIup_T_activated_FOShi, "Results/DE/UCNIup_T_activated_FOShi.csv")
GO_UCIup_T_activated_FOShi=enrichr(UCIup_T_activated_FOShi$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_T_activated_FOShi <- filter(GO_UCIup_T_activated_FOShi, GO_UCIup_T_activated_FOShi$Adjusted.P.value< 0.05)
GO_UCNIup_T_activated_FOShi=enrichr(UCNIup_T_activated_FOShi$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_T_activated_FOShi <- filter(GO_UCNIup_T_activated_FOShi, GO_UCNIup_T_activated_FOShi$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_T_activated_FOShi, "Results/DE/GO_UCNIup_T_activated_FOShi.csv")
write.csv(GO_UCIup_T_activated_FOShi, "Results/DE/GO_UCIup_T_activated_FOShi.csv")

UCINI_GC <- FindMarkers(data_UC, subset.ident = "GC", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_GC <- filter(UCINI_GC, UCINI_GC$p_val_adj < 0.05)
UCINI_GC$cluster = ifelse(UCINI_GC$avg_logFC > 0,"I","NI")
UCINI_GC$gene = rownames(UCINI_GC)
UCIup_GC = filter(UCINI_GC, UCINI_GC$cluster == "I")
UCNIup_GC = filter(UCINI_GC, UCINI_GC$cluster == "NI")
write.csv(UCIup_GC, "Results/DE/UCIup_GC.csv")
write.csv(UCNIup_GC, "Results/DE/UCNIup_GC.csv")
GO_UCIup_GC=enrichr(UCIup_GC$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_GC <- filter(GO_UCIup_GC, GO_UCIup_GC$Adjusted.P.value< 0.05)
GO_UCNIup_GC=enrichr(UCNIup_GC$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_GC <- filter(GO_UCNIup_GC, GO_UCNIup_GC$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_GC, "Results/DE/GO_UCNIup_GC.csv")
write.csv(GO_UCIup_GC, "Results/DE/GO_UCIup_GC.csv")

UCINI_Cycling_B <- FindMarkers(data_UC, subset.ident = "Cycling_B", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Cycling_B <- filter(UCINI_Cycling_B, UCINI_Cycling_B$p_val_adj < 0.05)
UCINI_Cycling_B$cluster = ifelse(UCINI_Cycling_B$avg_logFC > 0,"I","NI")
UCINI_Cycling_B$gene = rownames(UCINI_Cycling_B)
UCIup_Cycling_B = filter(UCINI_Cycling_B, UCINI_Cycling_B$cluster == "I")
UCNIup_Cycling_B = filter(UCINI_Cycling_B, UCINI_Cycling_B$cluster == "NI")
write.csv(UCIup_Cycling_B, "Results/DE/UCIup_Cycling_B.csv")
write.csv(UCNIup_Cycling_B, "Results/DE/UCNIup_Cycling_B.csv")
GO_UCIup_Cycling_B=enrichr(UCIup_Cycling_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Cycling_B <- filter(GO_UCIup_Cycling_B, GO_UCIup_Cycling_B$Adjusted.P.value< 0.05)
GO_UCNIup_Cycling_B=enrichr(UCNIup_Cycling_B$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Cycling_B <- filter(GO_UCNIup_Cycling_B, GO_UCNIup_Cycling_B$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Cycling_B, "Results/DE/GO_UCNIup_Cycling_B.csv")
write.csv(GO_UCIup_Cycling_B, "Results/DE/GO_UCIup_Cycling_B.csv")

UCINI_Cycling_T <- FindMarkers(data_UC, subset.ident = "Cycling_T", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Cycling_T <- filter(UCINI_Cycling_T, UCINI_Cycling_T$p_val_adj < 0.05)
UCINI_Cycling_T$cluster = ifelse(UCINI_Cycling_T$avg_logFC > 0,"I","NI")
UCINI_Cycling_T$gene = rownames(UCINI_Cycling_T)
UCIup_Cycling_T = filter(UCINI_Cycling_T, UCINI_Cycling_T$cluster == "I")
UCNIup_Cycling_T = filter(UCINI_Cycling_T, UCINI_Cycling_T$cluster == "NI")
write.csv(UCIup_Cycling_T, "Results/DE/UCIup_Cycling_T.csv")
write.csv(UCNIup_Cycling_T, "Results/DE/UCNIup_Cycling_T.csv")
GO_UCIup_Cycling_T=enrichr(UCIup_Cycling_T$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Cycling_T <- filter(GO_UCIup_Cycling_T, GO_UCIup_Cycling_T$Adjusted.P.value< 0.05)
GO_UCNIup_Cycling_T=enrichr(UCNIup_Cycling_T$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Cycling_T <- filter(GO_UCNIup_Cycling_T, GO_UCNIup_Cycling_T$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Cycling_T, "Results/DE/GO_UCNIup_Cycling_T.csv")
write.csv(GO_UCIup_Cycling_T, "Results/DE/GO_UCIup_Cycling_T.csv")

UCINI_IgM <- FindMarkers(data_UC, subset.ident = "IgM_plasma", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_IgM <- filter(UCINI_IgM, UCINI_IgM$p_val_adj < 0.05)
UCINI_IgM$cluster = ifelse(UCINI_IgM$avg_logFC > 0,"I","NI")
UCINI_IgM$gene = rownames(UCINI_IgM)
UCIup_IgM = filter(UCINI_IgM, UCINI_IgM$cluster == "I")
UCNIup_IgM = filter(UCINI_IgM, UCINI_IgM$cluster == "NI")
write.csv(UCIup_IgM, "Results/DE/UCIup_IgM.csv")
write.csv(UCNIup_IgM, "Results/DE/UCNIup_IgM.csv")
GO_UCIup_IgM=enrichr(UCIup_IgM$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_IgM <- filter(GO_UCIup_IgM, GO_UCIup_IgM$Adjusted.P.value< 0.05)
GO_UCNIup_IgM=enrichr(UCNIup_IgM$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_IgM <- filter(GO_UCNIup_IgM, GO_UCNIup_IgM$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_IgM, "Results/DE/GO_UCNIup_IgM.csv")
write.csv(GO_UCIup_IgM, "Results/DE/GO_UCIup_IgM.csv")

UCINI_imm_entero <- FindMarkers(data_UC, subset.ident = "Immature_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_imm_entero <- filter(UCINI_imm_entero, UCINI_imm_entero$p_val_adj < 0.05)
UCINI_imm_entero$cluster = ifelse(UCINI_imm_entero$avg_logFC > 0,"I","NI")
UCINI_imm_entero$gene = rownames(UCINI_imm_entero)
UCIup_imm_entero = filter(UCINI_imm_entero, UCINI_imm_entero$cluster == "I")
UCNIup_imm_entero = filter(UCINI_imm_entero, UCINI_imm_entero$cluster == "NI")
write.csv(UCIup_imm_entero, "Results/DE/UCIup_imm_entero.csv")
write.csv(UCNIup_imm_entero, "Results/DE/UCNIup_imm_entero.csv")
GO_UCIup_imm_entero=enrichr(UCIup_imm_entero$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_imm_entero <- filter(GO_UCIup_imm_entero, GO_UCIup_imm_entero$Adjusted.P.value< 0.05)
GO_UCNIup_imm_entero=enrichr(UCNIup_imm_entero$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_imm_entero <- filter(GO_UCNIup_imm_entero, GO_UCNIup_imm_entero$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_imm_entero, "Results/DE/GO_UCNIup_imm_entero.csv")
write.csv(GO_UCIup_imm_entero, "Results/DE/GO_UCIup_imm_entero.csv")

UCINI_Cycling_TA <- FindMarkers(data_UC, subset.ident = "Cycling_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Cycling_TA <- filter(UCINI_Cycling_TA, UCINI_Cycling_TA$p_val_adj < 0.05)
UCINI_Cycling_TA$cluster = ifelse(UCINI_Cycling_TA$avg_logFC > 0,"I","NI")
UCINI_Cycling_TA$gene = rownames(UCINI_Cycling_TA)
UCIup_Cycling_TA = filter(UCINI_Cycling_TA, UCINI_Cycling_TA$cluster == "I")
UCNIup_Cycling_TA = filter(UCINI_Cycling_TA, UCINI_Cycling_TA$cluster == "NI")
write.csv(UCIup_Cycling_TA, "Results/DE/UCIup_Cycling_TA.csv")
write.csv(UCNIup_Cycling_TA, "Results/DE/UCNIup_Cycling_TA.csv")
GO_UCIup_Cycling_TA=enrichr(UCIup_Cycling_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Cycling_TA <- filter(GO_UCIup_Cycling_TA, GO_UCIup_Cycling_TA$Adjusted.P.value< 0.05)
GO_UCNIup_Cycling_TA=enrichr(UCNIup_Cycling_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Cycling_TA <- filter(GO_UCNIup_Cycling_TA, GO_UCNIup_Cycling_TA$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Cycling_TA, "Results/DE/GO_UCNIup_Cycling_TA.csv")
write.csv(GO_UCIup_Cycling_TA, "Results/DE/GO_UCIup_Cycling_TA.csv")

UCINI_Ribo_TA <- FindMarkers(data_UC, subset.ident = "Ribo_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Ribo_TA <- filter(UCINI_Ribo_TA, UCINI_Ribo_TA$p_val_adj < 0.05)
UCINI_Ribo_TA$cluster = ifelse(UCINI_Ribo_TA$avg_logFC > 0,"I","NI")
UCINI_Ribo_TA$gene = rownames(UCINI_Ribo_TA)
UCIup_Ribo_TA = filter(UCINI_Ribo_TA, UCINI_Ribo_TA$cluster == "I")
UCNIup_Ribo_TA = filter(UCINI_Ribo_TA, UCINI_Ribo_TA$cluster == "NI")
write.csv(UCIup_Ribo_TA, "Results/DE/UCIup_Ribo_TA.csv")
write.csv(UCNIup_Ribo_TA, "Results/DE/UCNIup_Ribo_TA.csv")
GO_UCIup_Ribo_TA=enrichr(UCIup_Ribo_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Ribo_TA <- filter(GO_UCIup_Ribo_TA, GO_UCIup_Ribo_TA$Adjusted.P.value< 0.05)
GO_UCNIup_Ribo_TA=enrichr(UCNIup_Ribo_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Ribo_TA <- filter(GO_UCNIup_Ribo_TA, GO_UCNIup_Ribo_TA$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Ribo_TA, "Results/DE/GO_UCNIup_Ribo_TA.csv")
write.csv(GO_UCIup_Ribo_TA, "Results/DE/GO_UCIup_Ribo_TA.csv")

UCINI_BEST4 <- FindMarkers(data_UC, subset.ident = "BEST4_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_BEST4 <- filter(UCINI_BEST4, UCINI_BEST4$p_val_adj < 0.05)
UCINI_BEST4$cluster = ifelse(UCINI_BEST4$avg_logFC > 0,"I","NI")
UCINI_BEST4$gene = rownames(UCINI_BEST4)
UCIup_BEST4 = filter(UCINI_BEST4, UCINI_BEST4$cluster == "I")
UCNIup_BEST4 = filter(UCINI_BEST4, UCINI_BEST4$cluster == "NI")
write.csv(UCIup_BEST4, "Results/DE/UCIup_BEST4.csv")
write.csv(UCNIup_BEST4, "Results/DE/UCNIup_BEST4.csv")
GO_UCIup_BEST4=enrichr(UCIup_BEST4$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_BEST4 <- filter(GO_UCIup_BEST4, GO_UCIup_BEST4$Adjusted.P.value< 0.05)
GO_UCNIup_BEST4=enrichr(UCNIup_BEST4$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_BEST4 <- filter(GO_UCNIup_BEST4, GO_UCNIup_BEST4$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_BEST4, "Results/DE/GO_UCNIup_BEST4.csv")
write.csv(GO_UCIup_BEST4, "Results/DE/GO_UCIup_BEST4.csv")

UCINI_imm_goblet <- FindMarkers(data_UC, subset.ident = "Immature_goblet", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_imm_goblet <- filter(UCINI_imm_goblet, UCINI_imm_goblet$p_val_adj < 0.05)
UCINI_imm_goblet$cluster = ifelse(UCINI_imm_goblet$avg_logFC > 0,"I","NI")
UCINI_imm_goblet$gene = rownames(UCINI_imm_goblet)
UCIup_imm_goblet = filter(UCINI_imm_goblet, UCINI_imm_goblet$cluster == "I")
UCNIup_imm_goblet = filter(UCINI_imm_goblet, UCINI_imm_goblet$cluster == "NI")
write.csv(UCIup_imm_goblet, "Results/DE/UCIup_imm_goblet.csv")
write.csv(UCNIup_imm_goblet, "Results/DE/UCNIup_imm_goblet.csv")
GO_UCIup_imm_goblet=enrichr(UCIup_imm_goblet$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_imm_goblet <- filter(GO_UCIup_imm_goblet, GO_UCIup_imm_goblet$Adjusted.P.value< 0.05)
GO_UCNIup_imm_goblet=enrichr(UCNIup_imm_goblet$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_imm_goblet <- filter(GO_UCNIup_imm_goblet, GO_UCNIup_imm_goblet$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_imm_goblet, "Results/DE/GO_UCNIup_imm_goblet.csv")
write.csv(GO_UCIup_imm_goblet, "Results/DE/GO_UCIup_imm_goblet.csv")

UCINI_DUOX2 <- FindMarkers(data_UC, subset.ident = "DUOX2_enterocyte", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_DUOX2 <- filter(UCINI_DUOX2, UCINI_DUOX2$p_val_adj < 0.05)
UCINI_DUOX2$cluster = ifelse(UCINI_DUOX2$avg_logFC > 0,"I","NI")
UCINI_DUOX2$gene = rownames(UCINI_DUOX2)
UCIup_DUOX2 = filter(UCINI_DUOX2, UCINI_DUOX2$cluster == "I")
UCNIup_DUOX2 = filter(UCINI_DUOX2, UCINI_DUOX2$cluster == "NI")
write.csv(UCIup_DUOX2, "Results/DE/UCIup_DUOX2.csv")
write.csv(UCNIup_DUOX2, "Results/DE/UCNIup_DUOX2.csv")
GO_UCIup_DUOX2=enrichr(UCIup_DUOX2$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_DUOX2 <- filter(GO_UCIup_DUOX2, GO_UCIup_DUOX2$Adjusted.P.value< 0.05)
GO_UCNIup_DUOX2=enrichr(UCNIup_DUOX2$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_DUOX2 <- filter(GO_UCNIup_DUOX2, GO_UCNIup_DUOX2$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_DUOX2, "Results/DE/GO_UCNIup_DUOX2.csv")
write.csv(GO_UCIup_DUOX2, "Results/DE/GO_UCIup_DUOX2.csv")

UCINI_PLCG2_TA <- FindMarkers(data_UC, subset.ident = "PLCG2_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_PLCG2_TA <- filter(UCINI_PLCG2_TA, UCINI_PLCG2_TA$p_val_adj < 0.05)
UCINI_PLCG2_TA$cluster = ifelse(UCINI_PLCG2_TA$avg_logFC > 0,"I","NI")
UCINI_PLCG2_TA$gene = rownames(UCINI_PLCG2_TA)
UCIup_PLCG2_TA = filter(UCINI_PLCG2_TA, UCINI_PLCG2_TA$cluster == "I")
UCNIup_PLCG2_TA = filter(UCINI_PLCG2_TA, UCINI_PLCG2_TA$cluster == "NI")
write.csv(UCIup_PLCG2_TA, "Results/DE/UCIup_PLCG2_TA.csv")
write.csv(UCNIup_PLCG2_TA, "Results/DE/UCNIup_PLCG2_TA.csv")
GO_UCIup_PLCG2_TA=enrichr(UCIup_PLCG2_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_PLCG2_TA <- filter(GO_UCIup_PLCG2_TA, GO_UCIup_PLCG2_TA$Adjusted.P.value< 0.05)
GO_UCNIup_PLCG2_TA=enrichr(UCNIup_PLCG2_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_PLCG2_TA <- filter(GO_UCNIup_PLCG2_TA, GO_UCNIup_PLCG2_TA$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_PLCG2_TA, "Results/DE/GO_UCNIup_PLCG2_TA.csv")
write.csv(GO_UCIup_PLCG2_TA, "Results/DE/GO_UCIup_PLCG2_TA.csv")

UCINI_Absorptive_TA <- FindMarkers(data_UC, subset.ident = "Absorptive_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Absorptive_TA <- filter(UCINI_Absorptive_TA, UCINI_Absorptive_TA$p_val_adj < 0.05)
UCINI_Absorptive_TA$cluster = ifelse(UCINI_Absorptive_TA$avg_logFC > 0,"I","NI")
UCINI_Absorptive_TA$gene = rownames(UCINI_Absorptive_TA)
UCIup_Absorptive_TA = filter(UCINI_Absorptive_TA, UCINI_Absorptive_TA$cluster == "I")
UCNIup_Absorptive_TA = filter(UCINI_Absorptive_TA, UCINI_Absorptive_TA$cluster == "NI")
write.csv(UCIup_Absorptive_TA, "Results/DE/UCIup_Absorptive_TA.csv")
write.csv(UCNIup_Absorptive_TA, "Results/DE/UCNIup_Absorptive_TA.csv")
GO_UCIup_Absorptive_TA=enrichr(UCIup_Absorptive_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Absorptive_TA <- filter(GO_UCIup_Absorptive_TA, GO_UCIup_Absorptive_TA$Adjusted.P.value< 0.05)
GO_UCNIup_Absorptive_TA=enrichr(UCNIup_Absorptive_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Absorptive_TA <- filter(GO_UCNIup_Absorptive_TA, GO_UCNIup_Absorptive_TA$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Absorptive_TA, "Results/DE/GO_UCNIup_Absorptive_TA.csv")
write.csv(GO_UCIup_Absorptive_TA, "Results/DE/GO_UCIup_Absorptive_TA.csv")

UCINI_Tuft <- FindMarkers(data_UC, subset.ident = "Tuft", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_Tuft <- filter(UCINI_Tuft, UCINI_Tuft$p_val_adj < 0.05)
UCINI_Tuft$cluster = ifelse(UCINI_Tuft$avg_logFC > 0,"I","NI")
UCINI_Tuft$gene = rownames(UCINI_Tuft)
UCIup_Tuft = filter(UCINI_Tuft, UCINI_Tuft$cluster == "I")
UCNIup_Tuft = filter(UCINI_Tuft, UCINI_Tuft$cluster == "NI")
write.csv(UCIup_Tuft, "Results/DE/UCIup_Tuft.csv")
write.csv(UCNIup_Tuft, "Results/DE/UCNIup_Tuft.csv")
GO_UCIup_Tuft=enrichr(UCIup_Tuft$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_Tuft <- filter(GO_UCIup_Tuft, GO_UCIup_Tuft$Adjusted.P.value< 0.05)
GO_UCNIup_Tuft=enrichr(UCNIup_Tuft$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_Tuft <- filter(GO_UCNIup_Tuft, GO_UCNIup_Tuft$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_Tuft, "Results/DE/GO_UCNIup_Tuft.csv")
write.csv(GO_UCIup_Tuft, "Results/DE/GO_UCIup_Tuft.csv")

UCINI_REG_TA <- FindMarkers(data_UC, subset.ident = "REG_TA", group.by = "inflammation", test.use = "MAST", ident.1 = "I", ident.2 = "NI")
UCINI_REG_TA <- filter(UCINI_REG_TA, UCINI_REG_TA$p_val_adj < 0.05)
UCINI_REG_TA$cluster = ifelse(UCINI_REG_TA$avg_logFC > 0,"I","NI")
UCINI_REG_TA$gene = rownames(UCINI_REG_TA)
UCIup_REG_TA = filter(UCINI_REG_TA, UCINI_REG_TA$cluster == "I")
UCNIup_REG_TA = filter(UCINI_REG_TA, UCINI_REG_TA$cluster == "NI")
write.csv(UCIup_REG_TA, "Results/DE/UCIup_REG_TA.csv")
write.csv(UCNIup_REG_TA, "Results/DE/UCNIup_REG_TA.csv")
GO_UCIup_REG_TA=enrichr(UCIup_REG_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCIup_REG_TA <- filter(GO_UCIup_REG_TA, GO_UCIup_REG_TA$Adjusted.P.value< 0.05)
GO_UCNIup_REG_TA=enrichr(UCNIup_REG_TA$gene, databases = "GO_Biological_Process_2018")$GO_Biological_Process
GO_UCNIup_REG_TA <- filter(GO_UCNIup_REG_TA, GO_UCNIup_REG_TA$Adjusted.P.value< 0.05)
write.csv(GO_UCNIup_REG_TA, "Results/DE/GO_UCNIup_REG_TA.csv")
write.csv(GO_UCIup_REG_TA, "Results/DE/GO_UCIup_REG_TA.csv")

